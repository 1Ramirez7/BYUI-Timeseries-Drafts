<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>BYU-Idaho Time Series â€“ chapter_4_lesson_4</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./chapter_4_lesson_3.html" rel="prev">
<link href="./images/TSFavicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./images/TSfavicon_inv.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">BYU-Idaho Time Series</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Table of Contents</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./resource_blog.html" rel="" target="">
 <span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-chapter-1" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Chapter 1</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-chapter-1">    
        <li class="dropdown-header">Overview</li>
        <li>
    <a class="dropdown-item" href="./chapter_1.html" rel="" target="">
 <span class="dropdown-text">Lessons &amp; Homework</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Lesson 1</li>
        <li>
    <a class="dropdown-item" href="./chapter_1_lesson_1.html" rel="" target="">
 <span class="dropdown-text">Course Introduction</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Lesson 2</li>
        <li>
    <a class="dropdown-item" href="./chapter_1_lesson_2.html" rel="" target="">
 <span class="dropdown-text">Plots Trends, and Seasonal Variation</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Lesson 3</li>
        <li>
    <a class="dropdown-item" href="./chapter_1_lesson_3.html" rel="" target="">
 <span class="dropdown-text">Averages for Time Series</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Lesson 4</li>
        <li>
    <a class="dropdown-item" href="./chapter_1_lesson_4.html" rel="" target="">
 <span class="dropdown-text">Additive Models</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Lesson 5</li>
        <li>
    <a class="dropdown-item" href="./chapter_1_lesson_5.html" rel="" target="">
 <span class="dropdown-text">Multiplicative Models</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-chapter-2" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Chapter 2</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-chapter-2">    
        <li class="dropdown-header">Overview</li>
        <li>
    <a class="dropdown-item" href="./chapter_2.html" rel="" target="">
 <span class="dropdown-text">Lessons &amp; Homework</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Lesson 1</li>
        <li>
    <a class="dropdown-item" href="./chapter_2_lesson_1.html" rel="" target="">
 <span class="dropdown-text">Covariance and Correlation</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Lesson 2</li>
        <li>
    <a class="dropdown-item" href="./chapter_2_lesson_2.html" rel="" target="">
 <span class="dropdown-text">Autocorrelation Concepts</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Lesson 3</li>
        <li>
    <a class="dropdown-item" href="./chapter_2_lesson_3.html" rel="" target="">
 <span class="dropdown-text">Exploration of Autocorrelation Concepts</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-chapter-3" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Chapter 3</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-chapter-3">    
        <li class="dropdown-header">Overview</li>
        <li>
    <a class="dropdown-item" href="./chapter_3.html" rel="" target="">
 <span class="dropdown-text">Lessons &amp; Homework</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Lesson 1</li>
        <li>
    <a class="dropdown-item" href="./chapter_3_lesson_1.html" rel="" target="">
 <span class="dropdown-text">Leading Variables and Associated Variables</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Lesson 2</li>
        <li>
    <a class="dropdown-item" href="./chapter_3_lesson_2.html" rel="" target="">
 <span class="dropdown-text">Exponential Smoothing (EWMA)</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Lesson 3</li>
        <li>
    <a class="dropdown-item" href="./chapter_3_lesson_3.html" rel="" target="">
 <span class="dropdown-text">Holt-Winters Method (Additive Model) - Part 1</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Lesson 4</li>
        <li>
    <a class="dropdown-item" href="./chapter_3_lesson_4.html" rel="" target="">
 <span class="dropdown-text">Holt-Winters Method (Additive Model) - Part 2</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Lesson 5</li>
        <li>
    <a class="dropdown-item" href="./chapter_3_lesson_5.html" rel="" target="">
 <span class="dropdown-text">Holt-Winters Method (Multiplicative Models)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-chapter-4" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Chapter 4</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-chapter-4">    
        <li class="dropdown-header">Overview</li>
        <li>
    <a class="dropdown-item" href="./chapter_4.html" rel="" target="">
 <span class="dropdown-text">Lessons &amp; Homework</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Lesson 1</li>
        <li>
    <a class="dropdown-item" href="./chapter_4_lesson_1.html" rel="" target="">
 <span class="dropdown-text">White Noise and Random Walks: Part 1</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Lesson 2</li>
        <li>
    <a class="dropdown-item" href="./chapter_4_lesson_2.html" rel="" target="">
 <span class="dropdown-text">White Noise and Random Walks: Part 2</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Lesson 3</li>
        <li>
    <a class="dropdown-item" href="./chapter_4_lesson_3.html" rel="" target="">
 <span class="dropdown-text">Autoregressive Models</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Lesson 4</li>
        <li>
    <a class="dropdown-item" href="./chapter_4_lesson_4.html" rel="" target="">
 <span class="dropdown-text">Learning Outcomes</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Lesson 5</li>
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#learning-outcomes" id="toc-learning-outcomes" class="nav-link active" data-scroll-target="#learning-outcomes">Learning Outcomes</a></li>
  <li><a href="#preparation" id="toc-preparation" class="nav-link" data-scroll-target="#preparation">Preparation</a></li>
  <li><a href="#learning-journal-exchange-10-mins" id="toc-learning-journal-exchange-10-mins" class="nav-link" data-scroll-target="#learning-journal-exchange-10-mins">Learning Journal Exchange (10 mins)</a></li>
  <li><a href="#class-activity-fitting-a-simulated-ar1-model-with-zero-mean-10-min" id="toc-class-activity-fitting-a-simulated-ar1-model-with-zero-mean-10-min" class="nav-link" data-scroll-target="#class-activity-fitting-a-simulated-ar1-model-with-zero-mean-10-min">Class Activity: Fitting a Simulated <span class="math inline">\(AR(1)\)</span> Model with Zero Mean (10 min)</a>
  <ul class="collapse">
  <li><a href="#simulate-an-ar1-time-series" id="toc-simulate-an-ar1-time-series" class="nav-link" data-scroll-target="#simulate-an-ar1-time-series">Simulate an <span class="math inline">\(AR(1)\)</span> Time Series</a></li>
  <li><a href="#fit-an-ar1-model-with-zero-mean" id="toc-fit-an-ar1-model-with-zero-mean" class="nav-link" data-scroll-target="#fit-an-ar1-model-with-zero-mean">Fit an <span class="math inline">\(AR(1)\)</span> Model with Zero Mean</a></li>
  <li><a href="#confidence-interval-for-the-model-parameter" id="toc-confidence-interval-for-the-model-parameter" class="nav-link" data-scroll-target="#confidence-interval-for-the-model-parameter">Confidence Interval for the Model Parameter</a></li>
  <li><a href="#residuals" id="toc-residuals" class="nav-link" data-scroll-target="#residuals">Residuals</a></li>
  </ul></li>
  <li><a href="#class-activity-fitting-a-simulated-ar1-model-with-non-zero-mean-10-min" id="toc-class-activity-fitting-a-simulated-ar1-model-with-non-zero-mean-10-min" class="nav-link" data-scroll-target="#class-activity-fitting-a-simulated-ar1-model-with-non-zero-mean-10-min">Class Activity: Fitting a Simulated <span class="math inline">\(AR(1)\)</span> Model with Non-Zero Mean (10 min)</a>
  <ul class="collapse">
  <li><a href="#simulate-an-ar1-time-series-1" id="toc-simulate-an-ar1-time-series-1" class="nav-link" data-scroll-target="#simulate-an-ar1-time-series-1">Simulate an <span class="math inline">\(AR(1)\)</span> Time Series</a></li>
  <li><a href="#fit-an-ar1-model-with-non-zero-mean" id="toc-fit-an-ar1-model-with-non-zero-mean" class="nav-link" data-scroll-target="#fit-an-ar1-model-with-non-zero-mean">Fit an <span class="math inline">\(AR(1)\)</span> Model with Non-Zero Mean</a></li>
  <li><a href="#confidence-intervals-for-the-model-parameters" id="toc-confidence-intervals-for-the-model-parameters" class="nav-link" data-scroll-target="#confidence-intervals-for-the-model-parameters">Confidence Intervals for the Model Parameters</a></li>
  <li><a href="#residuals-1" id="toc-residuals-1" class="nav-link" data-scroll-target="#residuals-1">Residuals</a></li>
  </ul></li>
  <li><a href="#class-activity-fitting-a-simulated-ar2-model-10-min" id="toc-class-activity-fitting-a-simulated-ar2-model-10-min" class="nav-link" data-scroll-target="#class-activity-fitting-a-simulated-ar2-model-10-min">Class Activity: Fitting a Simulated <span class="math inline">\(AR(2)\)</span> Model (10 min)</a>
  <ul class="collapse">
  <li><a href="#simulate-an-ar2-time-series" id="toc-simulate-an-ar2-time-series" class="nav-link" data-scroll-target="#simulate-an-ar2-time-series">Simulate an <span class="math inline">\(AR(2)\)</span> Time Series</a></li>
  <li><a href="#fit-an-ar2-model" id="toc-fit-an-ar2-model" class="nav-link" data-scroll-target="#fit-an-ar2-model">Fit an <span class="math inline">\(AR(2)\)</span> Model</a></li>
  <li><a href="#confidence-interval-for-the-model-parameters" id="toc-confidence-interval-for-the-model-parameters" class="nav-link" data-scroll-target="#confidence-interval-for-the-model-parameters">Confidence Interval for the Model Parameters</a></li>
  <li><a href="#residuals-2" id="toc-residuals-2" class="nav-link" data-scroll-target="#residuals-2">Residuals</a></li>
  </ul></li>
  <li><a href="#small-group-activity-global-warming-20-min" id="toc-small-group-activity-global-warming-20-min" class="nav-link" data-scroll-target="#small-group-activity-global-warming-20-min">Small-Group Activity: Global Warming (20 min)</a>
  <ul class="collapse">
  <li><a href="#using-the-pacf-to-choose-p-for-an-arp-process" id="toc-using-the-pacf-to-choose-p-for-an-arp-process" class="nav-link" data-scroll-target="#using-the-pacf-to-choose-p-for-an-arp-process">Using the PACF to Choose <span class="math inline">\(p\)</span> for an <span class="math inline">\(AR(p)\)</span> Process</a></li>
  <li><a href="#fitting-models-dynamic-number-of-parameters" id="toc-fitting-models-dynamic-number-of-parameters" class="nav-link" data-scroll-target="#fitting-models-dynamic-number-of-parameters">Fitting Models (Dynamic Number of Parameters)</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul></li>
  <li><a href="#class-activity-forecasting-with-an-arp-model-5-min" id="toc-class-activity-forecasting-with-an-arp-model-5-min" class="nav-link" data-scroll-target="#class-activity-forecasting-with-an-arp-model-5-min">Class Activity: Forecasting with an <span class="math inline">\(AR(p)\)</span> Model (5 min)</a></li>
  <li><a href="#homework-preview-5-min" id="toc-homework-preview-5-min" class="nav-link" data-scroll-target="#homework-preview-5-min">Homework Preview (5 min)</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"></h1>
<p class="subtitle lead">Chapter 4: Lesson 4</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<script type="text/javascript">
 function showhide(id) {
    var e = document.getElementById(id);
    e.style.display = (e.style.display == 'block') ? 'none' : 'block';
 }
 
 function openTab(evt, tabName) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " active";
 }    
</script>
<section id="learning-outcomes" class="level2">
<h2 class="anchored" data-anchor-id="learning-outcomes">Learning Outcomes</h2>
<details>
<summary>
Fit time series models to data and interpret fitted parameters
</summary>
<ul>
<li>Fit an <span class="math inline">\(AR(p)\)</span> model to simulated data</li>
<li>Explain the difference between parameters of the data generating process and estimates</li>
<li>Calculate confidence intervals for AR coefficient estimates</li>
<li>Interpret AR coefficient estimates in the context of the source and nature of historical data</li>
</ul>
</details>
<details>
<summary>
Check model adequacy using diagnostic plots like correlograms of residuals
</summary>
<ul>
<li>Compare AR fitted models to an underlying data generating process</li>
<li>Explain the limitations of stochastic model fitting as evidence in favor or against real world arguments.</li>
</ul>
</details>
</section>
<section id="preparation" class="level2">
<h2 class="anchored" data-anchor-id="preparation">Preparation</h2>
<ul>
<li>Read Sections 4.6-4.7</li>
</ul>
</section>
<section id="learning-journal-exchange-10-mins" class="level2">
<h2 class="anchored" data-anchor-id="learning-journal-exchange-10-mins">Learning Journal Exchange (10 mins)</h2>
<ul>
<li><p>Review another studentâ€™s journal</p></li>
<li><p>What would you add to your learning journal after reading another studentâ€™s?</p></li>
<li><p>What would you recommend the other student add to their learning journal?</p></li>
<li><p>Sign the Learning Journal review sheet for your peer</p></li>
</ul>
</section>
<section id="class-activity-fitting-a-simulated-ar1-model-with-zero-mean-10-min" class="level2">
<h2 class="anchored" data-anchor-id="class-activity-fitting-a-simulated-ar1-model-with-zero-mean-10-min">Class Activity: Fitting a Simulated <span class="math inline">\(AR(1)\)</span> Model with Zero Mean (10 min)</h2>
<p>We will demonstrate how AR models are fitted via simulation. We will fit two different <span class="math inline">\(AR(1)\)</span> models and an <span class="math inline">\(AR(2)\)</span> model. The advantage of using simulation is that we know how the time series was constructed. So, we know the model that was used and the actual values of the parameters in that model. We can then see how close our estimated parameter values are to the true values.</p>
<section id="simulate-an-ar1-time-series" class="level3">
<h3 class="anchored" data-anchor-id="simulate-an-ar1-time-series">Simulate an <span class="math inline">\(AR(1)\)</span> Time Series</h3>
<p>In this simulation, we first simulate data from the <span class="math inline">\(AR(1)\)</span> model <span class="math display">\[
  x_t = 0.75 ~ x_{t-1} + w_t
\]</span> where <span class="math inline">\(w_t\)</span> is a white noise process with variance 1.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>n_rep <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>alpha1 <span class="ot">&lt;-</span> <span class="fl">0.75</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>dat_ts <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">w =</span> <span class="fu">rnorm</span>(n_rep)) <span class="sc">|&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">index =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(),</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> purrr<span class="sc">::</span><span class="fu">accumulate2</span>(</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lag</span>(w), w, </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>      \(acc, nxt, w) alpha1 <span class="sc">*</span> acc <span class="sc">+</span> w,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">.init =</span> <span class="dv">0</span>)[<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">|&gt;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  tsibble<span class="sc">::</span><span class="fu">as_tsibble</span>(<span class="at">index =</span> index)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>dat_ts <span class="sc">|&gt;</span> </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">.vars =</span> x) <span class="sc">+</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Time"</span>,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Simulated Time Series"</span>,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Simulated Values from an AR(1) Process"</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="chapter_4_lesson_4_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The R command <code>mean(dat_ts$x)</code> gives the mean of the <span class="math inline">\(x_t\)</span> values as 0.067.</p>
</section>
<section id="fit-an-ar1-model-with-zero-mean" class="level3">
<h3 class="anchored" data-anchor-id="fit-an-ar1-model-with-zero-mean">Fit an <span class="math inline">\(AR(1)\)</span> Model with Zero Mean</h3>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the AR(1) model</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>fit_ar <span class="ot">&lt;-</span> dat_ts <span class="sc">|&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">AR</span>(x <span class="sc">~</span> <span class="fu">order</span>(<span class="dv">1</span>)))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(fit_ar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 Ã— 6
  .model           term  estimate std.error statistic   p.value
  &lt;chr&gt;            &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 AR(x ~ order(1)) ar1      0.720    0.0220      32.8 2.07e-160</code></pre>
</div>
</div>
<p>The estimate of the parameter <span class="math inline">\(\alpha_1\)</span> (i.e.&nbsp;the fitted value of the parameter <span class="math inline">\(\alpha_1\)</span>) is <span class="math inline">\(\hat \alpha_1 = 0.72\)</span>.</p>
<p>When R fits an AR model, the mean of the time series is subtracted from the data before the parameter values are estimated. If R detects that the mean of the time series is not significantly different from zero, it is omitted from the output.</p>
<p>Because the mean is subtracted from the time series before the parameter values are estimated, R is using the model <span class="math display">\[
  z_t = \alpha_1 ~ z_{t-1} + w_t
\]</span> where <span class="math inline">\(z_t = x_t - \alpha_0\)</span> and <span class="math inline">\(\alpha_0\)</span> is the mean of the time series.</p>
<!-- Check Your Understanding -->
<div class="callout callout-style-default callout-tip no-icon callout-titled" title="Check Your Understanding">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check Your Understanding
</div>
</div>
<div class="callout-body-container callout-body">
<p>Answer the following questions with your partner.</p>
<ul>
<li>Use the expression for <span class="math inline">\(z_t\)</span> above to solve for <span class="math inline">\(x_t\)</span> in terms of <span class="math inline">\(x_{t-1}\)</span>, <span class="math inline">\(\alpha_0\)</span>, <span class="math inline">\(\alpha_1\)</span>, and <span class="math inline">\(w_t\)</span>.</li>
<li>What does your model reduce to when <span class="math inline">\(\alpha_0 = 0\)</span>?</li>
<li>Explain to your partner why this correctly models a time series with mean <span class="math inline">\(\alpha_0\)</span>.</li>
</ul>
</div>
</div>
<p>We replace the parameter <span class="math inline">\(\alpha_0\)</span> with its estimator <span class="math inline">\(\hat \alpha_0 = \bar x\)</span>. We also replace <span class="math inline">\(\alpha_1\)</span> with the fitted value from the output <span class="math inline">\(\hat \alpha_1\)</span>. This gives us the fitted model: <span class="math display">\[
  \hat x_t = \bar x + \hat \alpha_1 ~ (x_{t-1} - \bar x)
\]</span></p>
<p>The fitted model can be expressed as:</p>
<p><span class="math display">\[\begin{align*}
  \hat x_t
    &amp;= 0.067 + 0.72 \left( x_{t-1} - 0.067 \right) \\
    &amp;= 0.067 - 0.72 ~ (0.067) + 0.72 ~ \left( x_{t-1} \right) \\
    &amp;= 0.019 + 0.72 ~ x_{t-1}
\end{align*}\]</span></p>
<p>Even though R does not report the parameter for the mean of the process, <span class="math inline">\(\hat \alpha_0 = 0.019\)</span>, it is not significantly different from zero. One could argue that we should not use a model that contains the mean and instead focus on a simple fitted model that has only one parameter:</p>
<p><span class="math display">\[
  \hat x_t = 0.72 ~ x_{t-1}
\]</span></p>
</section>
<section id="confidence-interval-for-the-model-parameter" class="level3">
<h3 class="anchored" data-anchor-id="confidence-interval-for-the-model-parameter">Confidence Interval for the Model Parameter</h3>
<p>The P-value given above tests the hypothesis that <span class="math inline">\(\alpha_1=0\)</span>. This is not helpful in this context. We are interested in the plausible values for <span class="math inline">\(\alpha_1\)</span>, not whether or not it is different from zero. For this reason, we consider a confidence interval and disregard the P-value.</p>
<p>We can compute an approximate 95% confidence interval for <span class="math inline">\(\alpha_1\)</span> as: <span class="math display">\[
  \left(
    \hat \alpha_1 - 2 \cdot SE_{\hat \alpha_1}
    , ~
    \hat \alpha_1 + 2 \cdot SE_{\hat \alpha_1}
  \right)
\]</span> where <span class="math inline">\(\hat \alpha_1\)</span> is our parameter estimate and <span class="math inline">\(SE_{\hat \alpha_1}\)</span> is the standard error of the estimate. Both of these values are given in the R output.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ci_summary <span class="ot">&lt;-</span> <span class="fu">tidy</span>(fit_ar) <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">lower =</span> estimate <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> std.error,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> estimate <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> std.error</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>So, our 95% confidence interval for <span class="math inline">\(\alpha_1\)</span> is: <span class="math display">\[
  \left(
  0.72 - 2 \cdot 0.022
  , ~
  0.72 + 2 \cdot 0.022
  \right)
\]</span> or <span class="math display">\[
  \left(
  0.676
  , ~
  0.764
  \right)
\]</span> Note that the confidence interval contains <span class="math inline">\(\alpha_1 = 0.75\)</span>, the value of the parameter we used in our simulation. The process of estimating the parameter worked well. In practice, we will not know the value of <span class="math inline">\(\alpha_1\)</span>, but the confidence interval gives us a reasonable estimate of the value.</p>
</section>
<section id="residuals" class="level3">
<h3 class="anchored" data-anchor-id="residuals">Residuals</h3>
<p>For an <span class="math inline">\(AR(1)\)</span> model where the mean of the time series is not statistically significantly different from 0, the residuals are computed as <span class="math display">\[\begin{align*}
  r_t
    &amp;= x_t - \hat x_t \\
    &amp;= x_t - \left[ 0.72 ~ x_{t-1} \right]
\end{align*}\]</span></p>
<p>We can easily obtain these residual values in R:</p>
<p>The variance of the residuals is <span class="math inline">\(0.982\)</span>. This is very close to the actual value used in the simulation: <span class="math inline">\(\sigma^2 = 1\)</span>.</p>
<!-- Start of the next section -->
<!-- These parameters are used in the simulation below -->
</section>
</section>
<section id="class-activity-fitting-a-simulated-ar1-model-with-non-zero-mean-10-min" class="level2">
<h2 class="anchored" data-anchor-id="class-activity-fitting-a-simulated-ar1-model-with-non-zero-mean-10-min">Class Activity: Fitting a Simulated <span class="math inline">\(AR(1)\)</span> Model with Non-Zero Mean (10 min)</h2>
<section id="simulate-an-ar1-time-series-1" class="level3">
<h3 class="anchored" data-anchor-id="simulate-an-ar1-time-series-1">Simulate an <span class="math inline">\(AR(1)\)</span> Time Series</h3>
<p>It is easy to conceive situations where the mean of an AR model is not zero. The model we have been fitting is <span class="math display">\[
  x_t = \alpha_0 + \alpha_1 ~ \left( x_{t-1} - \alpha_0 \right) + w_t
\]</span> where <span class="math inline">\(\alpha_0\)</span> and <span class="math inline">\(\alpha_1\)</span> are constants, and <span class="math inline">\(w_t\)</span> is a white noise process with variance <span class="math inline">\(\sigma^2\)</span>.</p>
<p>This model can be simplified by combining like terms. <span class="math display">\[\begin{align*}
x_t
  &amp;= \alpha_0 + \alpha_1 ~ \left( x_{t-1} - \alpha_0 \right) + w_t \\
  &amp;= \underbrace{\alpha_0 - \alpha_1 ~ (\alpha_0)}_{\alpha_0'} + \alpha_1 ~ \left( x_{t-1} \right) + w_t \\
  &amp;= \alpha_0' + \alpha_1 ~ \left( x_{t-1} \right) + w_t
\end{align*}\]</span></p>
<p>Suppose the mean of the <span class="math inline">\(AR(1)\)</span> process is <span class="math inline">\(\alpha_0 = 50\)</span>. We will set <span class="math inline">\(\alpha_1 = 0.75\)</span>, and <span class="math inline">\(\sigma^2 = 5\)</span> for this simulation. After specifying these numbers, the model becomes: <span class="math display">\[\begin{align*}
  x_t
    &amp;= 50 + 0.75 ~ ( x_{t-1} - 50 ) + w_t \\
    &amp;= 50 - 0.75 ~ ( 50 ) + 0.75 ~ x_{t-1} + w_t \\
    &amp;= 12.5 + 0.75 ~ x_{t-1} + w_t
\end{align*}\]</span> where <span class="math inline">\(w_t\)</span> is a white noise process with variance <span class="math inline">\(\sigma^2 = 5\)</span>.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>n_rep <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>alpha1 <span class="ot">&lt;-</span> <span class="fl">0.75</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>sigma_sqr <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>dat_ts <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">w =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n_rep, <span class="at">sd =</span> <span class="fu">sqrt</span>(sigma_sqr))) <span class="sc">|&gt;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">index =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(),</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> purrr<span class="sc">::</span><span class="fu">accumulate2</span>(</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lag</span>(w), w, </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>      \(acc, nxt, w) alpha1 <span class="sc">*</span> acc <span class="sc">+</span> w,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">.init =</span> <span class="dv">0</span>)[<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">|&gt;</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> x <span class="sc">+</span> alpha0) <span class="sc">|&gt;</span> </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  tsibble<span class="sc">::</span><span class="fu">as_tsibble</span>(<span class="at">index =</span> index)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>dat_ts <span class="sc">|&gt;</span> </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">.vars =</span> x) <span class="sc">+</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Time"</span>,</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Simulated Time Series"</span>,</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Simulated Values from an AR(1) Process"</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="chapter_4_lesson_4_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The R command <code>mean(dat_ts$x)</code> gives the mean of the <span class="math inline">\(x_t\)</span> values as 50.15.</p>
</section>
<section id="fit-an-ar1-model-with-non-zero-mean" class="level3">
<h3 class="anchored" data-anchor-id="fit-an-ar1-model-with-non-zero-mean">Fit an <span class="math inline">\(AR(1)\)</span> Model with Non-Zero Mean</h3>
<p>We now use R to fit an <span class="math inline">\(AR(1)\)</span> model to the time series data.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the AR(1) model</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>fit_ar <span class="ot">&lt;-</span> dat_ts <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="fu">AR</span>(x <span class="sc">~</span> <span class="fu">order</span>(<span class="dv">1</span>)))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(fit_ar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 6
  .model           term     estimate std.error statistic   p.value
  &lt;chr&gt;            &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 AR(x ~ order(1)) constant   14.1      1.11        12.7 1.35e- 34
2 AR(x ~ order(1)) ar1         0.719    0.0220      32.7 5.95e-160</code></pre>
</div>
</div>
<p>The estimate of the parameter for the constant (mean) term <span class="math inline">\(\alpha_0'\)</span> is <span class="math inline">\(\hat \alpha_0' = 14.091\)</span>. The estimate of the parameter <span class="math inline">\(\alpha_1\)</span> (i.e.&nbsp;the fitted value of the parameter <span class="math inline">\(\alpha_1\)</span>) is <span class="math inline">\(\hat \alpha_1 = 0.719\)</span>.</p>
<!-- Recall that the mean of the time series is subtracted from the data before the parameter values are estimated. To estimate the time series, start with the mean and then add the coefficient $\hat \alpha_1$ multiplied by the difference between $x_{t-1}$ and the mean. -->
<p>Fitting the model <span class="math display">\[
  x_t = \alpha_0' + \alpha_1 ~ x_{t-1} + w_t
\]</span> we get <span class="math display">\[\begin{align*}
  \hat x_t
    &amp;= \hat \alpha_0' + \hat \alpha_1 ~ x_{t-1} \\
    &amp;= 14.091 +
      0.719
         ~ x_{t-1}
\end{align*}\]</span></p>
</section>
<section id="confidence-intervals-for-the-model-parameters" class="level3">
<h3 class="anchored" data-anchor-id="confidence-intervals-for-the-model-parameters">Confidence Intervals for the Model Parameters</h3>
<p>We can compute approximate 95% confidence intervals for <span class="math inline">\(\alpha_0'\)</span> and <span class="math inline">\(\alpha_1\)</span>:</p>
<p><span class="math display">\[
  \left(
    \hat \alpha_i - 2 \cdot SE_{\hat \alpha_i}
    , ~
    \hat \alpha_i + 2 \cdot SE_{\hat \alpha_i}
  \right)
\]</span> where <span class="math inline">\(\hat \alpha_i\)</span> is our estimate of parameter <span class="math inline">\(i \in \{0,1\}\)</span>, and <span class="math inline">\(SE_{\hat \alpha_i}\)</span> is the standard error of the respective estimates.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ci_summary <span class="ot">&lt;-</span> <span class="fu">tidy</span>(fit_ar) <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">lower =</span> estimate <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> std.error,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> estimate <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> std.error</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- Beginning of two columns -->
<div class="columns">
<div class="column" style="width:45%;">
<p>95% Confidence Interval for <span class="math inline">\(\alpha_0'\)</span>: <span class="math display">\[
  \left(
    \hat \alpha_0' - 2 \cdot SE_{\hat \alpha_0'}
    , ~
    \hat \alpha_0' + 2 \cdot SE_{\hat \alpha_0'}
  \right)
\]</span></p>
<p><span class="math display">\[
  \left(
  14.091 - 2 \cdot 1.105
  , ~
  14.091 + 2 \cdot 1.105
  \right)
\]</span></p>
<p><span class="math display">\[
  \left(
  11.88
  , ~
  16.301
  \right)
\]</span> The confidence interval for <span class="math inline">\(\alpha_0'\)</span> contains <span class="math display">\[\alpha_0' = \alpha_0 - \alpha_1 ~ (\alpha_0) = 12.5\]</span></p>
</div><div class="column" style="width:10%;">
<!-- empty column to create gap -->
</div><div class="column" style="width:45%;">
<p>95% Confidence Interval for <span class="math inline">\(\alpha_1\)</span>: <span class="math display">\[
  \left(
    \hat \alpha_1 - 2 \cdot SE_{\hat \alpha_1}
    , ~
    \hat \alpha_1 + 2 \cdot SE_{\hat \alpha_1}
  \right)
\]</span></p>
<p><span class="math display">\[
  \left(
  0.719 - 2 \cdot 0.022
  , ~
  0.719 + 2 \cdot 0.022
  \right)
\]</span></p>
<p><span class="math display">\[
  \left(
  0.675
  , ~
  0.763
  \right)
\]</span> The confidence interval for <span class="math inline">\(\alpha_1\)</span> contains <span class="math display">\[\alpha_1 = 0.75\]</span></p>
</div>
</div>
<!-- End of two columns -->
<p>Both intervals captured the true value used in the simulation. The process of estimating the parameter worked well. In practice, we will not know the value of <span class="math inline">\(\alpha_1\)</span>, but the confidence interval gives us a reasonable estimate of the value. About 95% of the time, the confidence interval will capture the true parameter value.</p>
</section>
<section id="residuals-1" class="level3">
<h3 class="anchored" data-anchor-id="residuals-1">Residuals</h3>
<p>The residuals in this model are computed as <span class="math display">\[\begin{align*}
  r_t
    &amp;= x_t - \hat x_t \\
    &amp;= x_t -
      \left[
        14.091 +
      0.719
         ~ x_{t-1}
      \right]
\end{align*}\]</span></p>
<p>The variance of the residuals is <span class="math inline">\(4.911\)</span>, which is near the actual parameter value: <span class="math inline">\(\sigma^2 = 5\)</span>.</p>
</section>
</section>
<section id="class-activity-fitting-a-simulated-ar2-model-10-min" class="level2">
<h2 class="anchored" data-anchor-id="class-activity-fitting-a-simulated-ar2-model-10-min">Class Activity: Fitting a Simulated <span class="math inline">\(AR(2)\)</span> Model (10 min)</h2>
<section id="simulate-an-ar2-time-series" class="level3">
<h3 class="anchored" data-anchor-id="simulate-an-ar2-time-series">Simulate an <span class="math inline">\(AR(2)\)</span> Time Series</h3>
<p>In this section, we will simulate data from the following <span class="math inline">\(AR(2)\)</span> process: <span class="math display">\[
  x_t = 2 + 0.5 ~ x_{t-1} + 0.4 ~ x_{t-2} + w_t
\]</span> where <span class="math inline">\(w_t\)</span> is a discrete white noise process with variance <span class="math inline">\(\sigma^2 = 9\)</span>.</p>
<!-- Check Your Understanding -->
<div class="callout callout-style-default callout-tip no-icon callout-titled" title="Check Your Understanding">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check Your Understanding
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use the <span class="math inline">\(AR(2)\)</span> process above to answer the following questions.</p>
<ul>
<li>Is this <span class="math inline">\(AR(2)\)</span> process stationary? (Hint: The characteristic polynomial only includes terms that involve <span class="math inline">\(x_t\)</span>.)</li>
<li>Rewrite the model in the form <span class="math display">\[
  x_t = \alpha_0 + \alpha_1 ~ ( x_{t-1} - \alpha_0) + \alpha_2 ~ ( x_{t-2} - \alpha_0) + w_t
\]</span> Identify the value of each of the coefficients (<span class="math inline">\(\alpha_0\)</span>, <span class="math inline">\(\alpha_1\)</span>, and <span class="math inline">\(\alpha_2\)</span>). <!-- Solution Solution Solution Solution Solution Solution --> <!-- \begin{align*} --> <!--   x_t  --> <!--     &= 20 + 0.5 ~ ( x_{t-1} - 20) + 0.4 ~ ( x_{t-2} - 20) + w_t \\ --> <!--     &= 2 + 0.5 ~ x_{t-1} + 0.4 ~ x_{t-2} + w_t --> <!-- \end{align*} --></li>
<li>What is the mean of this <span class="math inline">\(AR(2)\)</span> process?</li>
</ul>
</div>
</div>
<p>Here is a time plot of the simulated time series.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>n_rep <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>alpha0 <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>alpha1 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>alpha2 <span class="ot">&lt;-</span> <span class="fl">0.4</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>dat_ts <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">w =</span> <span class="fu">rnorm</span>(n_rep)) <span class="sc">|&gt;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">index =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(),</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="dv">0</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    tsibble<span class="sc">::</span><span class="fu">as_tsibble</span>(<span class="at">index =</span> index)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate x values</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>dat_ts<span class="sc">$</span>x[<span class="dv">1</span>] <span class="ot">&lt;-</span> alpha0 <span class="sc">+</span> dat_ts<span class="sc">$</span>w[<span class="dv">1</span>]</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>dat_ts<span class="sc">$</span>x[<span class="dv">2</span>] <span class="ot">&lt;-</span> alpha0 <span class="sc">+</span> alpha1 <span class="sc">*</span> ( dat_ts<span class="sc">$</span>x[<span class="dv">1</span>] <span class="sc">-</span> alpha0 ) <span class="sc">+</span> dat_ts<span class="sc">$</span>w[<span class="dv">2</span>]</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">3</span><span class="sc">:</span><span class="fu">nrow</span>(dat_ts)) {</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  dat_ts<span class="sc">$</span>x[i] <span class="ot">&lt;-</span> alpha0 <span class="sc">+</span> </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    alpha1 <span class="sc">*</span> ( dat_ts<span class="sc">$</span>x[i<span class="dv">-1</span>] <span class="sc">-</span> alpha0 ) <span class="sc">+</span> </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    alpha2 <span class="sc">*</span> ( dat_ts<span class="sc">$</span>x[i<span class="dv">-2</span>] <span class="sc">-</span> alpha0 ) <span class="sc">+</span> </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    dat_ts<span class="sc">$</span>w[i]</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>dat_ts <span class="sc">|&gt;</span> </span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">.vars =</span> x) <span class="sc">+</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Time"</span>,</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Simulated Time Series"</span>,</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Simulated Values from an AR(2) Process with Mean"</span>, alpha0)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="chapter_4_lesson_4_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="fit-an-ar2-model" class="level3">
<h3 class="anchored" data-anchor-id="fit-an-ar2-model">Fit an <span class="math inline">\(AR(2)\)</span> Model</h3>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the AR(2) model</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>fit_ar <span class="ot">&lt;-</span> dat_ts <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">model</span>(<span class="fu">AR</span>(x <span class="sc">~</span> <span class="fu">order</span>(<span class="dv">2</span>))) </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(fit_ar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 6
  .model           term     estimate std.error statistic  p.value
  &lt;chr&gt;            &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 AR(x ~ order(2)) constant    2.29     0.363       6.32 3.94e-10
2 AR(x ~ order(2)) ar1         0.478    0.0289     16.5  1.75e-54
3 AR(x ~ order(2)) ar2         0.408    0.0289     14.1  1.96e-41</code></pre>
</div>
</div>
<p>The estimates of the parameter values (i.e.&nbsp;the fitted values of the parameters) are:<br>
<span class="math inline">\(\hat \alpha_0' = 2.295\)</span>, <span class="math inline">\(\hat \alpha_1 = 0.478\)</span>, and <span class="math inline">\(\hat \alpha_2 = 0.408\)</span>. This means that our fitted model can be expressed as:</p>
<p><span class="math display">\[\begin{align*}
  \hat x_t
  &amp;=
    \hat \alpha_0'
    + \hat \alpha_1 ~ x_{t-1}
    + \hat \alpha_2 ~ x_{t-2}
    \\
  &amp;=
    2.295
    +
    0.478
    ~ x_{t-1}
    +
    0.408
    ~ x_{t-2}
\end{align*}\]</span></p>
</section>
<section id="confidence-interval-for-the-model-parameters" class="level3">
<h3 class="anchored" data-anchor-id="confidence-interval-for-the-model-parameters">Confidence Interval for the Model Parameters</h3>
<p>We can compute an approximate 95% confidence interval for <span class="math inline">\(\alpha_i\)</span> as: <span class="math display">\[
  \left(
    \hat \alpha_i - 2 \cdot SE_{\hat \alpha_i}
    , ~
    \hat \alpha_i + 2 \cdot SE_{\hat \alpha_i}
  \right)
\]</span> where <span class="math inline">\(\hat \alpha_i\)</span> is our estimate of the <span class="math inline">\(i^{th}\)</span> parameter and <span class="math inline">\(SE_{\hat \alpha_i}\)</span> is the standard error of the respective estimate. These values are given in the R output.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ci_summary <span class="ot">&lt;-</span> <span class="fu">tidy</span>(fit_ar) <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">lower =</span> estimate <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> std.error,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> estimate <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> std.error</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- Beginning of three columns -->
<div class="columns">
<div class="column" style="width:30%;">
<p>95% confidence interval for <span class="math inline">\(\alpha_0'\)</span>: <span class="math display">\[
  \left(
    \hat \alpha_0' - 2 \cdot SE_{\hat \alpha_0'}
    , ~
    \hat \alpha_0' + 2 \cdot SE_{\hat \alpha_0'}
  \right)
\]</span> <span class="math display">\[
  \left(
  2.295 - 2 \cdot 0.363
  ,
  \right.
  ~~~~~~~~~~~~~~~~~~~
  \]</span> <span class="math display">\[
  ~~~~~~~~~~~~~~~~~~~~~~
  \left.
  2.295 + 2 \cdot 0.363
  \right)
\]</span> <span class="math display">\[
  \left(
  1.569
  , ~
  3.021
  \right)
\]</span> This confidence interval contains <span class="math inline">\(\alpha_0' = 2\)</span>.</p>
</div><div class="column" style="width:5%;">
<!-- empty column to create gap -->
</div><div class="column" style="width:30%;">
<p>95% confidence interval for <span class="math inline">\(\alpha_1\)</span>: <span class="math display">\[
  \left(
    \hat \alpha_1 - 2 \cdot SE_{\hat \alpha_1}
    , ~
    \hat \alpha_1 + 2 \cdot SE_{\hat \alpha_1}
  \right)
\]</span> <span class="math display">\[
  \left(
  0.478 - 2 \cdot 0.029
  ,
  \right.
  ~~~~~~~~~~~~~~~~~~~
  \]</span> <span class="math display">\[
  ~~~~~~~~~~~~~~~~~~~~~~
  \left.
  0.478 + 2 \cdot 0.029
  \right)
\]</span> <span class="math display">\[
  \left(
  0.42
  , ~
  0.536
  \right)
\]</span> This confidence interval contains <span class="math inline">\(\alpha_1 = 0.5\)</span>.</p>
</div><div class="column" style="width:5%;">
<!-- empty column to create gap -->
</div><div class="column" style="width:30%;">
<p>95% confidence interval for <span class="math inline">\(\alpha_2\)</span>: <span class="math display">\[
  \left(
    \hat \alpha_2 - 2 \cdot SE_{\hat \alpha_2}
    , ~
    \hat \alpha_2 + 2 \cdot SE_{\hat \alpha_2}
  \right)
\]</span> <span class="math display">\[
  \left(
  0.408 - 2 \cdot 0.029
  ,
  \right.
  ~~~~~~~~~~~~~~~~~~~
  \]</span> <span class="math display">\[
  ~~~~~~~~~~~~~~~~~~~~~~
  \left.
  0.408 + 2 \cdot 0.029
  \right)
\]</span> <span class="math display">\[
  \left(
  0.35
  , ~
  0.466
  \right)
\]</span> This confidence interval contains <span class="math inline">\(\alpha_2 = 0.4\)</span>.</p>
</div>
</div>
<!-- End of three columns -->
<p>All three confidence intervals contain the true parameter values we used for the simulation.</p>
</section>
<section id="residuals-2" class="level3">
<h3 class="anchored" data-anchor-id="residuals-2">Residuals</h3>
<p>We can compute the residuals in the same manner as we did for the other models.</p>
<!-- Check Your Understanding -->
<div class="callout callout-style-default callout-tip no-icon callout-titled" title="Check Your Understanding">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check Your Understanding
</div>
</div>
<div class="callout-body-container callout-body">
<p>Working with a partner, do the following</p>
<ul>
<li>Write the expression used to compute the residuals.</li>
<li>Find the residuals of this sequence using your expression.</li>
<li>Here are the first few residuals. Compare these to the values you computed.</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 1,000 x 3 [1]
# Key:       .model [1]
   .model           index  .resid
   &lt;chr&gt;            &lt;int&gt;   &lt;dbl&gt;
 1 AR(x ~ order(2))     1 NA     
 2 AR(x ~ order(2))     2 NA     
 3 AR(x ~ order(2))     3  1.53  
 4 AR(x ~ order(2))     4  0.0791
 5 AR(x ~ order(2))     5  0.110 
 6 AR(x ~ order(2))     6  1.71  
 7 AR(x ~ order(2))     7  0.485 
 8 AR(x ~ order(2))     8 -1.26  
 9 AR(x ~ order(2))     9 -0.709 
10 AR(x ~ order(2))    10 -0.462 
# â„¹ 990 more rows</code></pre>
</div>
</div>
<ul>
<li>Explain why there are no residuals for times <span class="math inline">\(t=1\)</span> and <span class="math inline">\(t=2\)</span>.</li>
</ul>
</div>
</div>
</section>
</section>
<section id="small-group-activity-global-warming-20-min" class="level2">
<h2 class="anchored" data-anchor-id="small-group-activity-global-warming-20-min">Small-Group Activity: Global Warming (20 min)</h2>
<p>The time plot below illustrates the change in global surface temperature compared to the long-term average observed from 1951 to 1980. (Source: NASA/GISS.)</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>temps_ts <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(<span class="st">"data/global_temparature.csv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index =</span> year)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>temps_ts <span class="sc">|&gt;</span> <span class="fu">autoplot</span>(<span class="at">.vars =</span> change) <span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Temperature Change (Celsius)"</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Change in Mean Annual Global Temperature"</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="chapter_4_lesson_4_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="using-the-pacf-to-choose-p-for-an-arp-process" class="level3">
<h3 class="anchored" data-anchor-id="using-the-pacf-to-choose-p-for-an-arp-process">Using the PACF to Choose <span class="math inline">\(p\)</span> for an <span class="math inline">\(AR(p)\)</span> Process</h3>
<p>In the <a href="https://byuistats.github.io/timeseries/chapter_4_lesson_3.html#pacfTable">previous lesson</a>, we noted that the partial correlogram can be used to assess the number of parameters in an AR model. Here is a partial correlogram for the change in the mean annual global temperature.</p>
<!-- pacf(stock_ts$value, plot=TRUE, lag.max = 25) -->
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pacf</span>(temps_ts<span class="sc">$</span>change)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="chapter_4_lesson_4_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<!-- Check Your Understanding -->
<div class="callout callout-style-default callout-tip no-icon callout-titled" title="Check Your Understanding">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check Your Understanding
</div>
</div>
<div class="callout-body-container callout-body">
<p>Working with your partner, do the following:</p>
<ul>
<li>What value of <span class="math inline">\(p\)</span> for an <span class="math inline">\(AR(p)\)</span> model was suggested by the pacf?</li>
<li>Using the value of <span class="math inline">\(p\)</span> you identified, fit an <span class="math inline">\(AR(p)\)</span> model to the global temperature data. State the fitted <span class="math inline">\(AR(p)\)</span> model in the form <span class="math display">\[\hat x_t = \cdots\]</span></li>
<li>Obtain 95% confidence intervals for each of the parameters. Which are significantly different from zero?</li>
<li>Give the first three residual values (skipping the NAs).</li>
<li>What is the estimate of <span class="math inline">\(\sigma^2\)</span>?</li>
<li>Make a correlogram for the residuals. Does it appear that your model has fully explained the variation in the temperatures?</li>
</ul>
</div>
</div>
</section>
<section id="fitting-models-dynamic-number-of-parameters" class="level3">
<h3 class="anchored" data-anchor-id="fitting-models-dynamic-number-of-parameters">Fitting Models (Dynamic Number of Parameters)</h3>
<p>You may have concluded that <span class="math inline">\(p=3\)</span> might be insufficient for modeling these data. We now explore a technique that allows R to choose <span class="math inline">\(p\)</span> based on the significance of the parameters.</p>
<p>If we specify <code>order(1:9)</code> in the model statement, R returns the largest <span class="math inline">\(AR(p)\)</span> model (up to <span class="math inline">\(p=9\)</span>) for which the parameter <span class="math inline">\(\alpha_p\)</span> is significant.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>global_ar <span class="ot">&lt;-</span> temps_ts <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">model</span>(<span class="fu">AR</span>(change <span class="sc">~</span> <span class="fu">order</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>)))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(global_ar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 Ã— 6
  .model                  term     estimate std.error statistic  p.value
  &lt;chr&gt;                   &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 AR(change ~ order(1:9)) constant   0.0190   0.00881     2.15  3.30e- 2
2 AR(change ~ order(1:9)) ar1        0.656    0.0841      7.80  1.40e-12
3 AR(change ~ order(1:9)) ar2       -0.0662   0.100      -0.659 5.11e- 1
4 AR(change ~ order(1:9)) ar3        0.140    0.0988      1.42  1.58e- 1
5 AR(change ~ order(1:9)) ar4        0.265    0.0995      2.67  8.58e- 3
6 AR(change ~ order(1:9)) ar5       -0.163    0.102      -1.60  1.11e- 1
7 AR(change ~ order(1:9)) ar6        0.206    0.0863      2.38  1.85e- 2</code></pre>
</div>
</div>
<p>R returned an <span class="math inline">\(AR(6)\)</span> model for this time series.</p>
<!-- Check Your Understanding -->
<div class="callout callout-style-default callout-tip no-icon callout-titled" title="Check Your Understanding">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check Your Understanding
</div>
</div>
<div class="callout-body-container callout-body">
<p>Working with your partner, do the following:</p>
<ul>
<li>State the fitted <span class="math inline">\(AR(p)\)</span> model in the form <span class="math display">\[\hat x_t = \cdots\]</span></li>
<li>Obtain 95% confidence intervals for each of the parameters. Which are significantly different from zero?</li>
<li>Give the first three residual values (skipping the NAs).</li>
<li>What is the estimate of <span class="math inline">\(\sigma^2\)</span>?</li>
<li>Make a correlogram for the residuals. Does it appear that your model has fully explained the variation in the temperatures? Justify your answer.</li>
</ul>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(global_ar) <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">str_detect</span>(term, <span class="st">"ar1"</span>)) <span class="sc">|&gt;</span> <span class="fu">pull</span>(estimate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6559292</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>ci_summary <span class="ot">&lt;-</span> <span class="fu">tidy</span>(global_ar) <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">lower =</span> estimate <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> std.error,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> estimate <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> std.error</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>ci_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 Ã— 8
  .model             term  estimate std.error statistic  p.value    lower  upper
  &lt;chr&gt;              &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
1 AR(change ~ orderâ€¦ consâ€¦   0.0190   0.00881     2.15  3.30e- 2  0.00135 0.0366
2 AR(change ~ orderâ€¦ ar1     0.656    0.0841      7.80  1.40e-12  0.488   0.824 
3 AR(change ~ orderâ€¦ ar2    -0.0662   0.100      -0.659 5.11e- 1 -0.267   0.135 
4 AR(change ~ orderâ€¦ ar3     0.140    0.0988      1.42  1.58e- 1 -0.0574  0.338 
5 AR(change ~ orderâ€¦ ar4     0.265    0.0995      2.67  8.58e- 3  0.0663  0.464 
6 AR(change ~ orderâ€¦ ar5    -0.163    0.102      -1.60  1.11e- 1 -0.366   0.0405
7 AR(change ~ orderâ€¦ ar6     0.206    0.0863      2.38  1.85e- 2  0.0331  0.378 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">residuals</span>(global_ar) <span class="sc">|&gt;</span> <span class="fu">ACF</span>(<span class="at">lag_max =</span> <span class="dv">50</span>) <span class="sc">|&gt;</span> <span class="fu">autoplot</span>(<span class="at">.vars =</span> .resid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Response variable not specified, automatically selected `var = .resid`</code></pre>
</div>
<div class="cell-output-display">
<p><img src="chapter_4_lesson_4_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="conclusion" class="level3">
<h3 class="anchored" data-anchor-id="conclusion">Conclusion</h3>
<p>With the exception of a lone seemingly spurious autocorrelation, there are no significant values of the acf of the residuals in the <span class="math inline">\(AR(6)\)</span> model. This suggests that the model accounts for the variation in the time series.</p>
<!-- Check Your Understanding -->
<div class="callout callout-style-default callout-tip no-icon callout-titled" title="Check Your Understanding">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check Your Understanding
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Write the characteristic equation for the <span class="math inline">\(AR(6)\)</span> model you developed.</li>
<li>Click on the link below to obtain a more precise version of the characteristic equation, then solve the characteristic equation by any method. <a href="javascript:showhide('CharacteristicEquation')" style="font-size:.8em;">Class Activity</a></li>
</ul>
<div id="CharacteristicEquation" style="display:none;">
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># alphas[p&gt;0]</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>alphas <span class="ot">&lt;-</span> global_ar <span class="sc">%&gt;%</span> <span class="fu">coefficients</span>() <span class="sc">%&gt;%</span> <span class="fu">tail</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(estimate) <span class="sc">%&gt;%</span> <span class="fu">pull</span>()</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"0 = 1"</span>, </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"- ("</span>, alphas[<span class="dv">1</span>], <span class="st">") * x"</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"- ("</span>, alphas[<span class="dv">2</span>], <span class="st">") * x^2"</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"</span><span class="sc">\n</span><span class="st">     "</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"- ("</span>, alphas[<span class="dv">3</span>], <span class="st">") * x^3"</span>,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"- ("</span>, alphas[<span class="dv">4</span>], <span class="st">") * x^4"</span>,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"</span><span class="sc">\n</span><span class="st">     "</span>,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"- ("</span>, alphas[<span class="dv">5</span>], <span class="st">") * x^5"</span>,</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"- ("</span>, alphas[<span class="dv">6</span>], <span class="st">") * x^6"</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0 = 1 - ( 0.6559292 ) * x - ( -0.06617426 ) * x^2 
      - ( 0.140204 ) * x^3 - ( 0.2653744 ) * x^4 
      - ( -0.1627911 ) * x^5 - ( 0.2056924 ) * x^6</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">polyroot</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span>alphas))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  0.9838806+0.000000i -1.2890454+0.000000i -0.3076674-1.277838i
[4]  0.8559646-1.219125i -0.3076674+1.277838i  0.8559646+1.219125i</code></pre>
</div>
</div>
</div>
<ul>
<li>Is the <span class="math inline">\(AR(6)\)</span> model stationary?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abs</span>(<span class="fu">polyroot</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span>alphas)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9838806 1.2890454 1.3143548 1.4896112 1.3143548 1.4896112</code></pre>
</div>
</div>
<ul>
<li>THE GLOBAL WARMING TIME SERIES GIVEN IN THE BOOK IS STATIONARY!!!
<ul>
<li>IT WOULD BE FUN TO EXPLORE THE IDEAS ASSOICATED WITH THAT:</li>
<li>SMALLER SAMPLE SIZE, ESPECIALLY IN THE AREA WHERE THE ACTION ISâ€¦</li>
<li>DIFFERENT CONCLUSIONS BASED ON DIFFERENT DATAâ€¦</li>
<li>DATA NOT THE SAME, DIFFERENT WAYS OF ESTIMATING THE SAME THING</li>
<li>LOTS OF FUN IMPLICATIONS</li>
</ul></li>
<li>Explain how the choice of a model can bias the results.</li>
<li>Why is it important to carefully consider our model selection, including factors that might affect the results?</li>
</ul>
</div>
</div>
</section>
</section>
<section id="class-activity-forecasting-with-an-arp-model-5-min" class="level2">
<h2 class="anchored" data-anchor-id="class-activity-forecasting-with-an-arp-model-5-min">Class Activity: Forecasting with an <span class="math inline">\(AR(p)\)</span> Model (5 min)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>temps_forecast <span class="ot">&lt;-</span> global_ar <span class="sc">%&gt;%</span> <span class="fu">forecast</span>(<span class="at">h =</span> <span class="st">"20 years"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>temps_forecast <span class="sc">|&gt;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(temps_ts, <span class="at">level =</span> <span class="dv">95</span>) <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coord_cartesian(ylim = c(0,5500)) +</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .fitted, <span class="at">color =</span> <span class="st">"Fitted"</span>),</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">augment</span>(global_ar)) <span class="sc">+</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter_4_lesson_4_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># constant terms</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>alpha0 <span class="ot">&lt;-</span> global_ar <span class="sc">%&gt;%</span> <span class="fu">coefficients</span>() <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(estimate) <span class="sc">%&gt;%</span> <span class="fu">pull</span>()</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># other alphas</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>alphas <span class="ot">&lt;-</span> global_ar <span class="sc">%&gt;%</span> <span class="fu">coefficients</span>() <span class="sc">%&gt;%</span> <span class="fu">tail</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(estimate) <span class="sc">%&gt;%</span> <span class="fu">pull</span>()</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"0 = 1 "</span>, </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">" - ("</span>, alphas[<span class="dv">1</span>], <span class="st">") * x"</span>,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">" - ("</span>, alphas[<span class="dv">2</span>], <span class="st">") * x^2"</span>,</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">" - ("</span>, alphas[<span class="dv">3</span>], <span class="st">") * x^3"</span>,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">" - ("</span>, alphas[<span class="dv">4</span>], <span class="st">") * x^4"</span>,</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">" - ("</span>, alphas[<span class="dv">5</span>], <span class="st">") * x^5"</span>,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">" - ("</span>, alphas[<span class="dv">6</span>], <span class="st">") * x^6"</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>      )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "0 = 1  - (0.655929182472401) * x - (-0.0661742561340635) * x^2 - (0.140204028438433) * x^3 - (0.265374438296396) * x^4 - (-0.1627910647788) * x^5 - (0.205692419305318) * x^6"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"0 = 1"</span>, </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"- ("</span>, alphas[<span class="dv">1</span>], <span class="st">") * x"</span>,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"- ("</span>, alphas[<span class="dv">2</span>], <span class="st">") * x^2"</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"</span><span class="sc">\n</span><span class="st">     "</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"- ("</span>, alphas[<span class="dv">3</span>], <span class="st">") * x^3"</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"- ("</span>, alphas[<span class="dv">4</span>], <span class="st">") * x^4"</span>,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"</span><span class="sc">\n</span><span class="st">     "</span>,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"- ("</span>, alphas[<span class="dv">5</span>], <span class="st">") * x^5"</span>,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"- ("</span>, alphas[<span class="dv">6</span>], <span class="st">") * x^6"</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0 = 1 - ( 0.6559292 ) * x - ( -0.06617426 ) * x^2 
      - ( 0.140204 ) * x^3 - ( 0.2653744 ) * x^4 
      - ( -0.1627911 ) * x^5 - ( 0.2056924 ) * x^6</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>global_ar <span class="sc">%&gt;%</span> <span class="fu">coefficients</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 Ã— 6
  .model                  term     estimate std.error statistic  p.value
  &lt;chr&gt;                   &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 AR(change ~ order(1:9)) constant   0.0190   0.00881     2.15  3.30e- 2
2 AR(change ~ order(1:9)) ar1        0.656    0.0841      7.80  1.40e-12
3 AR(change ~ order(1:9)) ar2       -0.0662   0.100      -0.659 5.11e- 1
4 AR(change ~ order(1:9)) ar3        0.140    0.0988      1.42  1.58e- 1
5 AR(change ~ order(1:9)) ar4        0.265    0.0995      2.67  8.58e- 3
6 AR(change ~ order(1:9)) ar5       -0.163    0.102      -1.60  1.11e- 1
7 AR(change ~ order(1:9)) ar6        0.206    0.0863      2.38  1.85e- 2</code></pre>
</div>
</div>
<!-- Check your Understanding -->
<div class="callout callout-style-default callout-tip no-icon callout-titled" title="Check Your Understanding">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check Your Understanding
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Question1</li>
<li>Question2</li>
</ul>
</div>
</div>
</section>
<section id="homework-preview-5-min" class="level2">
<h2 class="anchored" data-anchor-id="homework-preview-5-min">Homework Preview (5 min)</h2>
<ul>
<li>Review upcoming homework assignment</li>
<li>Clarify questions</li>
</ul>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Download Homework
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="https://byuistats.github.io/timeseries/homework/homework_4_4.qmd" download="homework_4_4.qmd"> homework_4_4.qmd </a></p>
</div>
</div>
<p><a href="javascript:showhide('UsingPACFglobaltemps')" style="font-size:.8em;">Small-Group Activity: Global Warmingâ€“PACF</a></p>
<div id="UsingPACFglobaltemps" style="display:none;">
<div class="callout callout-style-default callout-tip no-icon callout-titled" title="Check Your Understanding">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check Your Understanding
</div>
</div>
<div class="callout-body-container callout-body">
<p>Working with your partner, do the following</p>
<ul>
<li>What value of <span class="math inline">\(p\)</span> for an <span class="math inline">\(AR(p)\)</span> model was suggested by the pacf?</li>
</ul>
<p><strong>Solution:</strong></p>
<p><span class="math display">\[p=3\]</span></p>
<hr>

<ul>
<li>Using the value of <span class="math inline">\(p\)</span> you identified, fit an <span class="math inline">\(AR(p)\)</span> model to the global temperature data. State the fitted <span class="math inline">\(AR(p)\)</span> model in the form <span class="math display">\[\hat x_t = \cdots\]</span></li>
</ul>
<p><strong>Solution:</strong></p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>global_ar <span class="ot">&lt;-</span> temps_ts <span class="sc">|&gt;</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">model</span>(<span class="fu">AR</span>(change <span class="sc">~</span> <span class="fu">order</span>(<span class="dv">3</span>)))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(global_ar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 6
  .model                term  estimate std.error statistic  p.value
  &lt;chr&gt;                 &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 AR(change ~ order(3)) ar1     0.737     0.0823     8.95  1.80e-15
2 AR(change ~ order(3)) ar2    -0.0350    0.103     -0.339 7.35e- 1
3 AR(change ~ order(3)) ar3     0.319     0.0839     3.80  2.15e- 4</code></pre>
</div>
</div>
<p>Note that the constant term is not statistically signficant. If we ignore this term, we get the fitted model:</p>
<p><span class="math display">\[\begin{align*}
  \hat x_t
  &amp;=
    0
    + \hat \alpha_1 ~ x_{t-1}
    + \hat \alpha_2 ~ x_{t-2}
    + \hat \alpha_3 ~ x_{t-3}
    \\
  &amp;=
    0.737
    ~ x_{t-1}
    +
    (-0.035)
    ~ x_{t-2}
    +
    0.319
    ~ x_{t-3}
\end{align*}\]</span></p>
<p>If we want to incorporate the constant term in the model, then we need to find the mean of the time series. The mean of the time series is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(temps_ts<span class="sc">$</span>change)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.06923611</code></pre>
</div>
</div>
<p>The fitted AR model is</p>
<p><span class="math display">\[\begin{align*}
  \hat x_t
  &amp;=
    \hat \alpha_0
    + \hat \alpha_1 ~ (x_{t-1} - \alpha_0)
    + \hat \alpha_2 ~ (x_{t-2} - \alpha_0)
    + \hat \alpha_3 ~ (x_{t-3} - \alpha_0)
    \\
  &amp;=
    \underbrace{
    \hat \alpha_0 - \hat \alpha_1 (\hat \alpha_0) - \hat \alpha_2 (\hat \alpha_0) - \hat \alpha_3 (\hat \alpha_0)
    }_{\hat \alpha_0'}
    + \hat \alpha_1 ~ x_{t-1}
    + \hat \alpha_2 ~ x_{t-2}
    + \hat \alpha_3 ~ x_{t-3}
    \\
  &amp;=
    \hat \alpha_0'
    + \hat \alpha_1 ~ x_{t-1}
    + \hat \alpha_2 ~ x_{t-2}
    + \hat \alpha_3 ~ x_{t-3}
\end{align*}\]</span> Or, after substituting the fitted values: <span class="math display">\[\begin{align*}
  \hat x_t
  &amp;=
    0.069
    +
    0.737
    ~ ( x_{t-1} - 0.069)
    +
    (-0.035)
    ~ ( x_{t-2} - 0.069)
    +
    0.319
    ~ ( x_{t-3} - 0.069) \\
  &amp;=
    -0.0014
    +
    0.737
    ~ x_{t-1}
    +
    (-0.035)
    ~ x_{t-2}
    +
    0.319
    ~ x_{t-3}
\end{align*}\]</span></p>
<hr>

<ul>
<li>Obtain 95% confidence intervals for each of the parameters. Which are significantly different from zero?</li>
</ul>
<p><strong>Solution:</strong></p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>ci_summary <span class="ot">&lt;-</span> <span class="fu">tidy</span>(global_ar) <span class="sc">|&gt;</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">lower =</span> estimate <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> std.error,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> estimate <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> std.error</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The confidence intervals are: <span class="math display">\[\begin{align*}
  \alpha_1: &amp;&amp;&amp;
    (
      0.572
      ,~
      0.901
    )
    \\
  \alpha_2: &amp;&amp;&amp;
    (
      -0.242
      ,~
      0.172
    )
    \\
  \alpha_3: &amp;&amp;&amp;
    (
      0.151
      ,~
      0.486
    )
\end{align*}\]</span></p>
The parameters <span class="math inline">\(\alpha_1\)</span> and <span class="math inline">\(\alpha_3\)</span> are statistically significantly different from 0.
<hr>

<ul>
<li>Give the first three residual values (skipping the NAs).</li>
</ul>
<p><strong>Solution:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>global_ar <span class="sc">|&gt;</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">residuals</span>() <span class="sc">|&gt;</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 3 x 3 [1Y]
# Key:       .model [1]
  .model                 year  .resid
  &lt;chr&gt;                 &lt;int&gt;   &lt;dbl&gt;
1 AR(change ~ order(3))  1883 -0.0413
2 AR(change ~ order(3))  1884 -0.130 
3 AR(change ~ order(3))  1885 -0.105 </code></pre>
</div>
</div>
<hr>

<ul>
<li>What is the estimate of <span class="math inline">\(\sigma^2\)</span>?</li>
</ul>
<p><strong>Solution:</strong></p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>resid_df <span class="ot">&lt;-</span> global_ar <span class="sc">|&gt;</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">residuals</span>() <span class="sc">|&gt;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(resid_df<span class="sc">$</span>.resid, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01114332</code></pre>
</div>
</div>
<hr>

<ul>
<li>Make a correlogram for the residuals. Does it appear that your model has fully explained the variation in the temperatures?</li>
</ul>
<p><strong>Solution:</strong></p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">residuals</span>(global_ar) <span class="sc">|&gt;</span> <span class="fu">ACF</span>(<span class="at">lag_max =</span> <span class="dv">50</span>) <span class="sc">|&gt;</span> <span class="fu">autoplot</span>(<span class="at">.vars =</span> .resid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Response variable not specified, automatically selected `var = .resid`</code></pre>
</div>
<div class="cell-output-display">
<p><img src="chapter_4_lesson_4_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>There is still a significant autocorrelation at lag <span class="math inline">\(k=3\)</span>. This suggests a more sophisticated model may be necessary.</p>
<hr>

</div>
</div>
<!-- End of check your understanding -->
</div>
<!-- End of UsingPACFglobaltemps solutions -->
<p><a href="javascript:showhide('DynamicPglobaltemps')" style="font-size:.8em;">Small-Group Activity: Global Warmingâ€“Dynamic</a></p>
<div id="DynamicPglobaltemps" style="display:none;">
<p>STUFF_GOES_HERE_<strong>STUFF_GOES_HERE</strong>_STUFF_GOES_HERE___STUFF_GOES_HERE</p>
</div>
<!-- End of DynamicPglobaltemps solutions -->
<p><a href="javascript:showhide('Solutions')" style="font-size:.8em;">Class Activity</a></p>
<div id="Solutions2" style="display:none;">

</div>
<p><a href="javascript:showhide('Solutions3')" style="font-size:.8em;">Class Activity</a></p>
<div id="Solutions3" style="display:none;">

</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./chapter_4_lesson_3.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Autoregressive Models</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->



</body></html>