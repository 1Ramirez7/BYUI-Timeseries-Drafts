{
  "hash": "4ddd60051df31e43222649bb6cf6284f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Autoregressive Moving Average (ARMA) Models\"\nsubtitle: \"Chapter 6: Lesson 2\"\nformat: html\neditor: source\nsidebar: false\n---\n\n\n\n\n\n\n  This could be broken into two lessons: One for theory and other for fitting & forecasting. \n  It was too rushed as one lesson.\n\n\n\n\n\n\n\n\n\n\n\n\n```{=html}\n<script type=\"text/javascript\">\n function showhide(id) {\n    var e = document.getElementById(id);\n    e.style.display = (e.style.display == 'block') ? 'none' : 'block';\n }\n \n function openTab(evt, tabName) {\n    var i, tabcontent, tablinks;\n    tabcontent = document.getElementsByClassName(\"tabcontent\");\n    for (i = 0; i < tabcontent.length; i++) {\n        tabcontent[i].style.display = \"none\";\n    }\n    tablinks = document.getElementsByClassName(\"tablinks\");\n    for (i = 0; i < tablinks.length; i++) {\n        tablinks[i].className = tablinks[i].className.replace(\" active\", \"\");\n    }\n    document.getElementById(tabName).style.display = \"block\";\n    evt.currentTarget.className += \" active\";\n }    \n</script>\n```\n\n\n\n\n\n## Learning Outcomes\n\n\n<details>\n\n<summary>Define autoregressive moving average (ARMA) models</summary>\n-   Write the equation for an ARMA(p,q) model \n-   Express an ARMA model in terms of the backward shift operators for the AR and MA components\n-   State facts about ARMA processes related to stationarity, invertibility, special cases, parsimony, and parameter redundancy\n-   Use ACF and PACF plots to determine if an AR, MA or ARMA model is appropriate for a time series\n\n</details>\n\n<details>\n\n<summary>Apply an iterative time series modeling process</summary>\n-   Fit a regression model to capture trend and seasonality\n-   Examine residual diagnostic plots to assess autocorrelation \n-   Fit an ARMA model to the residuals if needed\n-   Check the residuals of the ARMA model for white noise\n-   Forecast the original series by combining the regression and ARMA model forecasts\n\n</details>\n\n\n\n\n\n\n## Preparation\n\n-   Read Sections 6.5.1 and 6.6-6.7\n\n\n\n## Learning Journal Exchange (10 min)\n\n-   Review another student's journal\n\n-   What would you add to your learning journal after reading another student's?\n\n-   What would you recommend the other student add to their learning journal?\n\n-   Sign the Learning Journal review sheet for your peer\n\n\n\n\n## Class Activity: Introduction to Autoregressive Moving Average (ARMA) Models (10 min)\n\n### Autoregressive (AR) Models\n\nIn [Chapter 4, Lesson 3](https://byuistats.github.io/timeseries/chapter_4_lesson_3.html#ARdefinition), we learned the definition of an AR model:\n\n::: {.callout-note icon=false title=\"Definition of an Autoregressive (AR) Model\"}\n\nThe time series $\\{x_t\\}$ is an **autoregressive process of order $p$**, denoted as $AR(p)$, if\n$$\n  x_t = \\alpha_1 x_{t-1} + \\alpha_2 x_{t-2} + \\alpha_3 x_{t-3} + \\cdots + \\alpha_{p-1} x_{t-(p-1)} + \\alpha_p x_{t-p} + w_t ~~~~~~~~~~~~~~~~~~~~~~~ (4.15)\n$$\n\nwhere $\\{w_t\\}$ is white noise and the $\\alpha_i$ are the model parameters with $\\alpha_p \\ne 0$.\n\n:::\n\nThe $AR(p)$ model can be expressed as:\n$$\n  \\underbrace{\\left( 1 - \\alpha_1 \\mathbf{B} - \\alpha_2 \\mathbf{B}^2 - \\cdots - \\alpha_p \\mathbf{B}^p \\right)}_{\\theta_p \\left( \\mathbf{B} \\right)} x_t = w_t\n$$\n\n### Moving Average (MA) Models\n\nThe definition of an $MA(q)$ model is:\n\n::: {.callout-note icon=false title=\"Definition of a Moving Average (MA) Model\"}\n\nWe say that a time series $\\{x_t\\}$ is a **moving average process of order $q$**, denoted as $MA(q)$, if each term in the time series is a linear combination of the current white noise term and the $q$ most recent past white noise terms. \n\nIt is given as:\n$$\n  x_t = w_t + \\beta_1 w_{t-1} + \\beta_2 w_{t-2} + \\beta_3 w_{t-3} + \\cdots + \\beta_{q-1} w_{t-(q-1)} + \\beta_q w_{t-q}\n$$\n\nwhere $\\{w_t\\}$ is white noise with zero mean and variance $\\sigma_w^2$, and the $\\beta_i$ are the model parameters with $\\beta_q \\ne 0$.\n\n:::\n\nWritten in terms of the backward shift operator, we have \n$$\n  x_t = \\underbrace{\\left( 1 + \\beta_1 \\mathbf{B} + \\beta_2 \\mathbf{B}^2  + \\beta_3 \\mathbf{B}^3  + \\cdots + \\beta_{q-1} \\mathbf{B}^{q-1}  + \\beta_q \\mathbf{B}^{q} \\right)}_{\\phi_q(\\mathbf{B})} w_t\n$$\n\nPutting the $AR$ and $MA$ models together, we get the $ARMA$ model. \n\n::: {.callout-note icon=false title=\"Definition of an Autogregressive Moving Average (ARMA) Model\"}\n\nA time series $\\{ x_t \\}$ follows an **autoregressive moving average (ARMA) model** of order $(p, q)$, which we write as $ARMA(p,q)$, if it can be written as:\n\n$$\n  x_t = \n    \\underbrace{\n      \\alpha_1 x_{t-1} + \\alpha_2 x_{t-2} \n      + \\alpha_3 x_{t-3} \n      + \\cdots \n      % + \\alpha_{p-1} x_{t-(p-1)} + \n      \\alpha_p x_{t-p}\n    }_{\n      AR(p) ~ \\text{model}\n    } \n    + \\underbrace{\n      w_t + \\beta_1 w_{t-1} + \\beta_2 w_{t-2} \n      + \\beta_3 w_{t-3} \n      + \\cdots \n      % + \\beta_{q-1} w_{t-(q-1)} \n      + \\beta_q w_{t-q}\n    }_{\n      MA(q) ~ \\text{model}\n    } \n$$\nwhere $\\{w_t\\}$ is a white noise process.\n\n:::\n\nWe can write this as:\n$$\n  \\theta_p \\left( \\mathbf{B} \\right) x_t\n  =\n  \\phi_q \\left( \\mathbf{B} \\right) w_t\n$$\n\n::: {.callout-caution icon=false title=\"Facts about ARMA Processes\"}\n\nThe following facts are true for $ARMA(p,q)$ processes:\n\n-   The ARMA process is stationary if all the roots of $\\theta_p \\left( \\mathbf{B} \\right)$ are greater than 1 in absolute value.\n-   The ARMA process is invertible if all the roots of $\\phi_q \\left( \\mathbf{B} \\right)$ are greater than 1 in absolute value.\n-   The special case $ARMA(p,0)$ is the $AR(p)$ model.\n-   The special case $ARMA(0,q)$ is the $MA(q)$ model.\n-   An $ARMA$ model will usually require fewer parameters than a single $MA$ or $AR$ model. This is called *parameter parsimony*.\n-   If $\\theta$ and $\\phi$ have a common factor, a stationary model can be simplified. This is called *parameter redundancy*.\nAs an example, the model \n$$\n  \\left( 1 - \\frac{1}{2} \\mathbf{B} \\right)\\left( 1 - \\frac{1}{3} \\mathbf{B} \\right) x_t \n  = \n  \\left( 1-\\frac{1}{2} \\mathbf{B} \\right)\\left( 1 - \\frac{1}{4} \\mathbf{B} \\right) w_t\n$$ \nis the same as the model\n$$\n  \\left( 1 - \\frac{1}{3} \\mathbf{B} \\right) x_t \n  = \n  \\left( 1 - \\frac{1}{4} \\mathbf{B} \\right) w_t\n$$\n\n:::\n\n\n### Comparison of AR and MA Models\n::: {.callout-note icon=false title=\"ACF and PACF of an $AR(p)$ Process\"}\n\nWe can use the pacf and acf plots to assess if an $AR(p)$ or $MA(q)$ model is appropriate. \nFor an $AR(p)$ or $MA(q)$ process, we observe the following:\n\n<center>\n\n|      | AR(p)                  | MA(q)                  | ARMA(p,q)                |\n|------|------------------------|------------------------|--------------------------|\n| ACF  | Tails off              | Cuts off after lag $q$ | Tails off                |\n| PACF | Cuts off after lag $p$ | Tails off              | Tails off                |\n\n</center>\n\nhttps://people.cs.pitt.edu/~milos/courses/cs3750/lectures/class16.pdf \n\n:::\n\n\n### Analyzing Time Series with a Regular Seasonal Pattern\n\nHere are some steps you can use to guide your work as you analyze time series with a regular seasonal pattern. Even though these are presented linearly, you may find it helpful to iterate between some of the steps as needed.\n\n::: {.callout-warning icon=false title=\"Analyzing a Time Series with a Regular Seasonal Pattern\"}\n\n-   Create a time plot of the series\n-   Determine an appropriate model for the trend and seasonality; call this Model 1\n    -   Regression\n    -   Holt-Winters\n    -   Additive / Multiplicative Decomposition\n    -   Other Techniques\n-   Use AIC/AICc/BIC (or other metrics) and your reasoning skills to choose the best model\n-   Obtain the residuals\n-   Check the residuals of Model 1 for evidence of autocorrelation and non-stationarity\n    -   Time plot of the residuals\n    -   ACF plot\n    -   PACF plot\n-   Fit an AR/MA/ARMA model to the (stationary) residuals; call this Model 2\n-   Check the residuals of Model 2 for evidence of autocorrelation and normality\n    -   ACF plot\n    -   PACF plot\n    -   Histogram\n-   Forecast the trend and seasonality of the time series using Model 1\n-   Forecast the residuals of Model 1 using Model 2\n-   Add the two forecasts together\n-   Plot and summarize the resulting forecast\n-   Refine the models above as needed\n\n:::\n\n## Class Activity: Model for the Residuals from the Rexburg Weather Model (15 min)\n\n### Review\n\nWe now review the model we built in [Chapter 5 Lesson 3](https://byuistats.github.io/timeseries/chapter_5_lesson_3.html#weather) for the monthly average of the daily high temperature in Rexburg, Idaho.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nweather_df <- rio::import(\"https://byuistats.github.io/timeseries/data/rexburg_weather_monthly.csv\") |>\n  mutate(dates = my(date_text)) |>\n  filter(dates >= my(\"1/2008\") & dates <= my(\"12/2023\")) |>\n  rename(x = avg_daily_high_temp) |>\n  mutate(TIME = 1:n()) |>\n  mutate(\n    cos1 = cos(2 * pi * 1 * TIME/12),\n    cos2 = cos(2 * pi * 2 * TIME/12),\n    cos3 = cos(2 * pi * 3 * TIME/12),\n    cos4 = cos(2 * pi * 4 * TIME/12),\n    cos5 = cos(2 * pi * 5 * TIME/12),\n    cos6 = cos(2 * pi * 6 * TIME/12),\n    sin1 = sin(2 * pi * 1 * TIME/12),\n    sin2 = sin(2 * pi * 2 * TIME/12),\n    sin3 = sin(2 * pi * 3 * TIME/12),\n    sin4 = sin(2 * pi * 4 * TIME/12),\n    sin5 = sin(2 * pi * 5 * TIME/12),\n    sin6 = sin(2 * pi * 6 * TIME/12)) |>\n  mutate(zTIME = (TIME - mean(TIME)) / sd(TIME)) |>\n  as_tsibble(index = TIME)\n\nweather_df |>\n  as_tsibble(index = dates) |>\n  autoplot(.vars = x) +\n  geom_smooth(method = \"lm\", se = FALSE, color = \"#F0E442\") +\n    labs(\n      x = \"Month\",\n      y = \"Mean Daily High Temperature (Fahrenheit)\",\n      title = \"Time Plot of Mean Daily Rexburg High Temperature by Month\",\n      subtitle = paste0(\"(\", format(weather_df$dates %>% head(1), \"%b %Y\"), endash, format(weather_df$dates %>% tail(1), \"%b %Y\"), \")\")\n    ) +\n    theme_minimal() +\n    theme(\n      plot.title = element_text(hjust = 0.5),\n      plot.subtitle = element_text(hjust = 0.5)\n    )\n```\n\n::: {.cell-output-display}\n![Time plot of the monthly mean daily high temperatures in Rexburg Idaho, in degrees Fahrenheit](chapter_6_lesson_2_files/figure-html/fig-WeatherTimePlot-1.png){#fig-WeatherTimePlot width=672}\n:::\n:::\n\n\n\n\n\nWe chose the \"Reduced Linear 5\" model. For convenience, we reprint the coefficients here.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nreduced5_linear_lm <- weather_df |>\n  model(reduced_linear_5  = TSLM(x ~ zTIME + sin1 + cos1 + sin2 + cos2))\n\nreduced5_linear_lm |>\n  tidy() |>\n  mutate(sig = p.value < 0.05)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 7\n  .model           term        estimate std.error statistic   p.value sig  \n  <chr>            <chr>          <dbl>     <dbl>     <dbl>     <dbl> <lgl>\n1 reduced_linear_5 (Intercept)   56.5       0.279    202.   5.06e-220 TRUE \n2 reduced_linear_5 zTIME          0.692     0.280      2.47 1.44e-  2 TRUE \n3 reduced_linear_5 sin1         -16.1       0.395    -40.7  1.66e- 94 TRUE \n4 reduced_linear_5 cos1         -23.7       0.395    -60.1  9.40e-124 TRUE \n5 reduced_linear_5 sin2           1.26      0.395      3.20 1.60e-  3 TRUE \n6 reduced_linear_5 cos2          -2.86      0.395     -7.24 1.13e- 11 TRUE \n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nr5lin_coef_unrounded <- reduced5_linear_lm |>\n  tidy() |>\n  select(term, estimate, std.error)\n\nr5lin_coef <- r5lin_coef_unrounded |>\n  round_df(3)\n\nstats_unrounded <- weather_df |>\n  as_tibble() |>\n  dplyr::select(TIME) |>\n  summarize(mean = mean(TIME), sd = sd(TIME))\n\nstats <- stats_unrounded |>\n  round_df(3)\n```\n:::\n\n\n\n\nThe fitted model is:\n\n\\begin{align*}\n  x_t \n      &= \\hat \\beta_0 + \\hat \\beta_1 \\left( \\frac{t - \\bar t}{s_t} \\right)  \\\\\n      & ~~~~~~~~~~ + \\hat \\beta_2 \\sin \\left( \\frac{2\\pi \\cdot 1 t}{12} \\right) \n            + \\hat \\beta_3 \\cos \\left( \\frac{2\\pi \\cdot 1 t}{12} \\right) \\\\\n      & ~~~~~~~~~~ + \\hat \\beta_4 \\sin \\left( \\frac{2\\pi \\cdot 2 t}{12} \\right) \n            + \\hat \\beta_5 \\cos \\left( \\frac{2\\pi \\cdot 2 t}{12} \\right) \n      \\\\\n      &= 56.467 \n            + 0.692 \\left( \\frac{t - 96.5}{55.57} \\right) \\\\ \n      & ~~~~~~~~~~~~~~~~~ + (-16.068) \\sin \\left( \\frac{2\\pi \\cdot 1 t}{12} \\right) \n            + (-23.708) \\cos \\left( \\frac{2\\pi \\cdot 1 t}{12} \\right) \\\\\n      & ~~~~~~~~~~~~~~~~~ + 1.264 \\sin \\left( \\frac{2\\pi \\cdot 2 t}{12} \\right) \n            + (-2.858) \\cos \\left( \\frac{2\\pi \\cdot 2 t}{12} \\right) \n      \\\\\n\\end{align*}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nnum_months <- weather_df |> \n  as_tibble() |> \n  dplyr::select(TIME) |> \n  tail(1) |> \n  pull()\n\ndf <- tibble( TIME = seq(1, num_months, 0.01) ) |>\n  mutate(\n    cos1 = cos(2 * pi * 1 * TIME/12),\n    cos2 = cos(2 * pi * 2 * TIME/12),\n    cos3 = cos(2 * pi * 3 * TIME/12),\n    cos4 = cos(2 * pi * 4 * TIME/12),\n    cos5 = cos(2 * pi * 5 * TIME/12),\n    cos6 = cos(2 * pi * 6 * TIME/12),\n    sin1 = sin(2 * pi * 1 * TIME/12),\n    sin2 = sin(2 * pi * 2 * TIME/12),\n    sin3 = sin(2 * pi * 3 * TIME/12),\n    sin4 = sin(2 * pi * 4 * TIME/12),\n    sin5 = sin(2 * pi * 5 * TIME/12),\n    sin6 = sin(2 * pi * 6 * TIME/12)) |>\n  mutate(zTIME = (TIME - mean(TIME)) / sd(TIME)) |>\n  as_tsibble(index = TIME)\n\nlinear5_ts <- reduced5_linear_lm |>\n  forecast(df) |>\n  as_tibble() |>\n  dplyr::select(TIME, .mean) |>\n  rename(value = .mean) |>\n  mutate(Model = \"Linear 5\")\n\ndata_ts <- weather_df |> \n  as_tibble() |>\n  rename(value = x) |>\n  mutate(Model = \"Data\") |>\n  dplyr::select(TIME, value, Model)\n\ncombined_ts <- bind_rows(data_ts, linear5_ts) \npoint_ts <- combined_ts |> filter(TIME == floor(TIME))\n\nokabe_ito_colors <- c(\"#000000\", \"#E69F00\")\n\ncombined_ts |>\n  ggplot(aes(x = TIME, y = value, color = Model)) +\n  geom_line() +\n  geom_point(data = point_ts, alpha = 0.5) +\n  labs(\n      x = \"Month Number\",\n      y = \"Temperature (Fahrenheit)\",\n      title = \"Monthly Average of Daily High Temperatures in Rexburg\",\n      subtitle = paste0(\"(\", format(weather_df$dates %>% head(1), \"%b %Y\"), endash, format(weather_df$dates %>% tail(1), \"%b %Y\"), \")\")\n  ) +    \n  scale_color_manual(\n    values = okabe_ito_colors[1:nrow(combined_ts |> as_tibble() |> select(Model) |> unique())], \n    name = \"\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(hjust = 0.5),\n    plot.subtitle = element_text(hjust = 0.5),\n    legend.position = \"top\", # Position the legend at the top\n    legend.direction = \"horizontal\" # Set the legend direction to horizontal\n  )\n```\n\n::: {.cell-output-display}\n![Time plot of the monthly mean daily high temperatures in Rexburg Idaho, in degrees Fahrenheit; the fitted values from the regression model are given in orange](chapter_6_lesson_2_files/figure-html/fig-WeatherTimePlotWithForecast-1.png){#fig-WeatherTimePlotWithForecast width=672}\n:::\n:::\n\n\n\n\n\n### Fitting an ARMA(p,q) Model\n\nFirst, we create an acf and pacf plot of the residuals from the model above.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nreduced5_linear_lm |>\n  residuals() |>\n  ACF() |> \n  autoplot(var = .resid)\n```\n\n::: {.cell-output-display}\n![ACF Plot of the Residuals from the Rexburg Weather Model](chapter_6_lesson_2_files/figure-html/fig-acfResidWeather-1.png){#fig-acfResidWeather width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nreduced5_linear_lm |> \n  residuals() |>\n  PACF() |>\n  autoplot(var = .resid)\n```\n\n::: {.cell-output-display}\n![PACF Plot of the Residuals from the Rexburg Weather Model](chapter_6_lesson_2_files/figure-html/fig-pacfResidWeather-1.png){#fig-pacfResidWeather width=672}\n:::\n:::\n\n\n\n\n\n Check Your Understanding \n\n::: {.callout-tip icon=false title=\"Check Your Understanding\"}\n\n-   What ARMA model does the combined information in the acf and pacf plots suggest would be appropriate for the residuals of the Rexburg weather model?\n\n:::\n\nHere are summaries of some ARMA models that could be constructed.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_resid <- reduced5_linear_lm |>\n  residuals() |>\n  select(-.model) |>\n  model(\n    auto = ARIMA(.resid ~ 1 + pdq(0:2,0,0:2) + PDQ(0, 0, 0)),\n    a000 = ARIMA(.resid ~ 1 + pdq(0,0,0) + PDQ(0, 0, 0)),\n    a001 = ARIMA(.resid ~ 1 + pdq(0,0,1) + PDQ(0, 0, 0)),\n    a002 = ARIMA(.resid ~ 1 + pdq(0,0,2) + PDQ(0, 0, 0)),\n    a100 = ARIMA(.resid ~ 1 + pdq(1,0,0) + PDQ(0, 0, 0)),\n    a101 = ARIMA(.resid ~ 1 + pdq(1,0,1) + PDQ(0, 0, 0)),\n    a102 = ARIMA(.resid ~ 1 + pdq(1,0,2) + PDQ(0, 0, 0)),\n    a200 = ARIMA(.resid ~ 1 + pdq(2,0,0) + PDQ(0, 0, 0)),\n    a201 = ARIMA(.resid ~ 1 + pdq(2,0,1) + PDQ(0, 0, 0)),\n    a202 = ARIMA(.resid ~ 1 + pdq(2,0,2) + PDQ(0, 0, 0))) \n\nmodel_resid |>\n  glance() \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# model_best |>\n#   residuals() |>\n#   ACF() |>\n#   autoplot()\n\n\n# new_data <- tibble(\n#   date = seq(\n#     max(cbe_ts$date) + months(1),\n#       max(cbe_ts$date) + months(36),\n#       by = \"1 months\"),\n#   month = tsibble::yearmonth(date),  \n#   time = seq(nrow(cbe_ts), length = 36),\n#   imth = rep(1:12, 3)) |>\n#   as_tsibble(index = month)\n# \n# plot_dat <- new_data |>\n#   mutate(\n#     residuals = forecast(\n#       model_best,\n#       h = \"3 years\") |>\n#       pull(.mean),\n#     expected_log = forecast(\n#       elec_lm,\n#       new_data = new_data) |>\n#       pull(.mean),\n#     expected = exp(expected_log + residuals)  \n#   )\n# \n# ggplot() +\n#   geom_line(data = cbe_ts, aes(x = date, y = elec)) +\n#   geom_line(data = plot_dat, aes(x = date, y = expected), linetype = 2)\n```\n:::\n\n::: {#tbl-ModelComparison .cell tbl-cap='Comparison of the AIC, AICc, and BIC values for the models fitted to the Rexburg weather data'}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:center;\"> Model </th>\n   <th style=\"text-align:center;\"> AIC </th>\n   <th style=\"text-align:center;\"> AICc </th>\n   <th style=\"text-align:center;\"> BIC </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;min-width: 0in; \"> auto </td>\n   <td style=\"text-align:center;min-width: 0in; \"> **1056** </td>\n   <td style=\"text-align:center;min-width: 0in; \"> **1056.1** </td>\n   <td style=\"text-align:center;min-width: 0in; \"> **1065.7** </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;min-width: 0in; \"> a000 </td>\n   <td style=\"text-align:center;min-width: 0in; \"> 1062.1 </td>\n   <td style=\"text-align:center;min-width: 0in; \"> 1062.1 </td>\n   <td style=\"text-align:center;min-width: 0in; \"> 1068.6 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;min-width: 0in; \"> a001 </td>\n   <td style=\"text-align:center;min-width: 0in; \"> 1056.9 </td>\n   <td style=\"text-align:center;min-width: 0in; \"> 1057 </td>\n   <td style=\"text-align:center;min-width: 0in; \"> 1066.7 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;min-width: 0in; \"> a002 </td>\n   <td style=\"text-align:center;min-width: 0in; \"> 1057.9 </td>\n   <td style=\"text-align:center;min-width: 0in; \"> 1058.1 </td>\n   <td style=\"text-align:center;min-width: 0in; \"> 1071 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;min-width: 0in; \"> a100 </td>\n   <td style=\"text-align:center;min-width: 0in; \"> **1056** </td>\n   <td style=\"text-align:center;min-width: 0in; \"> **1056.1** </td>\n   <td style=\"text-align:center;min-width: 0in; \"> **1065.7** </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;min-width: 0in; \"> a101 </td>\n   <td style=\"text-align:center;min-width: 0in; \"> 1057.2 </td>\n   <td style=\"text-align:center;min-width: 0in; \"> 1057.4 </td>\n   <td style=\"text-align:center;min-width: 0in; \"> 1070.2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;min-width: 0in; \"> a102 </td>\n   <td style=\"text-align:center;min-width: 0in; \"> 1059.1 </td>\n   <td style=\"text-align:center;min-width: 0in; \"> 1059.4 </td>\n   <td style=\"text-align:center;min-width: 0in; \"> 1075.4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;min-width: 0in; \"> a200 </td>\n   <td style=\"text-align:center;min-width: 0in; \"> 1057.5 </td>\n   <td style=\"text-align:center;min-width: 0in; \"> 1057.7 </td>\n   <td style=\"text-align:center;min-width: 0in; \"> 1070.5 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;min-width: 0in; \"> a201 </td>\n   <td style=\"text-align:center;min-width: 0in; \"> 1059.1 </td>\n   <td style=\"text-align:center;min-width: 0in; \"> 1059.5 </td>\n   <td style=\"text-align:center;min-width: 0in; \"> 1075.4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;min-width: 0in; \"> a202 </td>\n   <td style=\"text-align:center;min-width: 0in; \"> 1059.6 </td>\n   <td style=\"text-align:center;min-width: 0in; \"> 1060 </td>\n   <td style=\"text-align:center;min-width: 0in; \"> 1079.1 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nmodel_resid |>\n  tidy() |>\n  filter(.model == \"a101\") \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 6\n  .model term     estimate std.error statistic p.value\n  <chr>  <chr>       <dbl>     <dbl>     <dbl>   <dbl>\n1 a101   ar1       0.528       0.262    2.02    0.0451\n2 a101   ma1      -0.341       0.288   -1.18    0.238 \n3 a101   constant  0.00236     0.176    0.0134  0.989 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nmodel_resid |>\n  select(a101) |>\n  residuals() |>\n  ACF() |>\n  autoplot(var = .resid)\n```\n\n::: {.cell-output-display}\n![ACF plot of the residuals from the $ARMA(1,1)$ model](chapter_6_lesson_2_files/figure-html/fig-ACFofResiduals-1.png){#fig-ACFofResiduals width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nmodel_resid |>\n  select(a101) |>\n  residuals() |>\n  PACF() |>\n  autoplot(var = .resid)\n```\n\n::: {.cell-output-display}\n![PACF plot of the residuals from the $ARMA(1,1)$ model](chapter_6_lesson_2_files/figure-html/fig-PACFofResiduals-1.png){#fig-PACFofResiduals width=672}\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n\n\n## Small-Group Activity: Industrial Electricity Consumption in Texas (20 min)\n\n\n\n\nThese data represent the amount of electricity used each month for industrial applications in Texas.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nelec_ts <- rio::import(\"https://byuistats.github.io/timeseries/data/electricity_tx.csv\") |>\n  dplyr::select(-comments) |>\n  mutate(month = my(month)) |>\n  mutate(\n    t = 1:n(),\n    std_t = (t - mean(t)) / sd(t)\n  ) |>\n  mutate(\n    cos1 = cos(2 * pi * 1 * t / 12),\n    cos2 = cos(2 * pi * 2 * t / 12),\n    cos3 = cos(2 * pi * 3 * t / 12),\n    cos4 = cos(2 * pi * 4 * t / 12),\n    cos5 = cos(2 * pi * 5 * t / 12),\n    cos6 = cos(2 * pi * 6 * t / 12),\n    sin1 = sin(2 * pi * 1 * t / 12),\n    sin2 = sin(2 * pi * 2 * t / 12),\n    sin3 = sin(2 * pi * 3 * t / 12),\n    sin4 = sin(2 * pi * 4 * t / 12),\n    sin5 = sin(2 * pi * 5 * t / 12)\n  ) |>\n  as_tsibble(index = month)\n\nelec_plot_raw <- elec_ts |>\n    autoplot(.vars = megawatthours) +\n    labs(\n      x = \"Month\",\n      y = \"Megawatt-hours\",\n      title = \"Texas' Industrial Electricity Use\"\n    ) +\n    theme_minimal() +\n    theme(\n      plot.title = element_text(hjust = 0.5)\n    )\n\nelec_plot_log <- elec_ts |>\n    autoplot(.vars = log(megawatthours)) +\n    labs(\n      x = \"Month\",\n      y = \"log(Megwatt-hours)\",\n      title = \"Log of Texas' Industrial Electricity Use\"\n    ) +\n    theme_minimal() +\n    theme(\n      plot.title = element_text(hjust = 0.5)\n    )\n\nelec_plot_raw | elec_plot_log\n```\n\n::: {.cell-output-display}\n![](chapter_6_lesson_2_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n\n\n Check Your Understanding \n\n::: {.callout-tip icon=false title=\"Check Your Understanding\"}\n\nUse the Texas industrial electricity consumption data to do the following.\n\n-   Select an appropriate model to fit the time series using the AIC, AICc, or BIC critera.\n-   Determine the best $ARMA(p,q)$ model for the residuals.\n -   Forecast the data for the next 5 years using the regression model. # not part of original\n -   Forecast the residuals for the next 5 years using ARMA model. # not part of original\n -   Sum the two forecasted time series and plot the combined series against the original retail sales data. # not part of original\n\n:::\n\n\n\n\n## Small Group Activity: Fitting an ARMA(p,q) Model to the Retail Data (30 min)\n\nApply what you have learned in this lesson to the retail sales data. In particular, consider full-service restaurants (NAICS code 722511). \n\n Check Your Understanding \n\n::: {.callout-tip icon=false title=\"Check Your Understanding\"}\n\nUse the total retail sales for full-service restaurants to do the following.\n\n-   Select an appropriate model to fit the time series using the AIC, AICc, or BIC critera.\n-   Determine the best $ARMA(p,q)$ model for the residuals.\n-   Forecast the data for the next 5 years using the regression model.\n-   Forecast the residuals for the next 5 years using ARMA model.\n-   Sum the two forecasted time series and plot the combined series against the original retail sales data.\n\n:::\n\n\nHere is some code you can use to help you get started.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n# Read in retail sales data for \"Full-Service Restaurants\"\nretail_ts <- rio::import(\"https://byuistats.github.io/timeseries/data/retail_by_business_type.parquet\") |>\n  filter(naics == 722511) |>\n  mutate(\n    month = yearmonth(as_date(month)),\n    month_number = month(month)\n  ) |>\n  mutate(t = 1:n()) |>\n  mutate(std_t = (t - mean(t)) / sd(t)) |>\n  mutate(\n    cos1 = cos(2 * pi * 1 * t / 12),\n    cos2 = cos(2 * pi * 2 * t / 12),\n    cos3 = cos(2 * pi * 3 * t / 12),\n    cos4 = cos(2 * pi * 4 * t / 12),\n    cos5 = cos(2 * pi * 5 * t / 12),\n    cos6 = cos(2 * pi * 6 * t / 12),\n    sin1 = sin(2 * pi * 1 * t / 12),\n    sin2 = sin(2 * pi * 2 * t / 12),\n    sin3 = sin(2 * pi * 3 * t / 12),\n    sin4 = sin(2 * pi * 4 * t / 12),\n    sin5 = sin(2 * pi * 5 * t / 12)\n  ) |>\n  mutate(\n    in_great_recession = ifelse(ym(month) >= my(\"December 2007\") & month <= my(\"June 2009\"), 1, 0),\n    after_great_recession = ifelse(ym(month) > my(\"June 2009\"), 1, 0)\n  ) |>\n  as_tsibble(index = month)\n\nretail_plot_raw <- retail_ts |>\n    autoplot(.vars = sales_millions) +\n    labs(\n      x = \"Month\",\n      y = \"sales_millions\",\n      title = \"Other General Merchandise Sales\"\n    ) +\n    theme_minimal() +\n    theme(\n      plot.title = element_text(hjust = 0.5)\n    )\n\nretail_plot_log <- retail_ts |>\n    autoplot(.vars = log(sales_millions)) +\n    labs(\n      x = \"Month\",\n      y = \"log(sales_millions)\",\n      title = \"Logarithm of Other Gen. Merch. Sales\"\n    ) +\n    theme_minimal() +\n    theme(\n      plot.title = element_text(hjust = 0.5)\n    )\n\nretail_plot_raw | retail_plot_log\n```\n\n::: {.cell-output-display}\n![Time plot of the time series (left) and the natural logarithm of the time series (right)](chapter_6_lesson_2_files/figure-html/fig-retailSideBySidePlot-1.png){#fig-retailSideBySidePlot width=672}\n:::\n:::\n\n::: {#tbl-modelFitting .cell tbl-cap='Coefficients for the fitted model for the total sales in full-service restaurants in the United States'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nretail_final_lm <- retail_ts |>\n  model(retail_full = TSLM(log(sales_millions) ~  \n      (in_great_recession * std_t) + (after_great_recession * std_t) \n      + (in_great_recession * I(std_t^2) ) + (after_great_recession * I(std_t^2) )\n      + (in_great_recession * I(std_t^3) ) + (after_great_recession * I(std_t^3) )\n      + sin1 + cos1 + sin2 + cos2 + sin3 + cos3\n      + sin4 + cos4 + sin5 + cos5 + cos6 # Note sin6 is omitted\n    )\n    ) \n\nretail_final_lm |>\n  tidy() |>\n  mutate(sig = p.value < 0.05) |>\n  knitr::kable(format = \"html\", align='ccccccc', escape = FALSE, width = NA, row.names = FALSE) |>\n  kable_styling(full_width = FALSE, \"striped\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:center;\"> .model </th>\n   <th style=\"text-align:center;\"> term </th>\n   <th style=\"text-align:center;\"> estimate </th>\n   <th style=\"text-align:center;\"> std.error </th>\n   <th style=\"text-align:center;\"> statistic </th>\n   <th style=\"text-align:center;\"> p.value </th>\n   <th style=\"text-align:center;\"> sig </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> retail_full </td>\n   <td style=\"text-align:center;\"> (Intercept) </td>\n   <td style=\"text-align:center;\"> 9.6959936 </td>\n   <td style=\"text-align:center;\"> 0.0062100 </td>\n   <td style=\"text-align:center;\"> 1561.3586384 </td>\n   <td style=\"text-align:center;\"> 0.0000000 </td>\n   <td style=\"text-align:center;\"> TRUE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> retail_full </td>\n   <td style=\"text-align:center;\"> in_great_recession </td>\n   <td style=\"text-align:center;\"> 0.1057700 </td>\n   <td style=\"text-align:center;\"> 0.1187801 </td>\n   <td style=\"text-align:center;\"> 0.8904693 </td>\n   <td style=\"text-align:center;\"> 0.3738957 </td>\n   <td style=\"text-align:center;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> retail_full </td>\n   <td style=\"text-align:center;\"> std_t </td>\n   <td style=\"text-align:center;\"> 0.4905760 </td>\n   <td style=\"text-align:center;\"> 0.0326870 </td>\n   <td style=\"text-align:center;\"> 15.0083105 </td>\n   <td style=\"text-align:center;\"> 0.0000000 </td>\n   <td style=\"text-align:center;\"> TRUE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> retail_full </td>\n   <td style=\"text-align:center;\"> after_great_recession </td>\n   <td style=\"text-align:center;\"> -0.1556298 </td>\n   <td style=\"text-align:center;\"> 0.0312565 </td>\n   <td style=\"text-align:center;\"> -4.9791109 </td>\n   <td style=\"text-align:center;\"> 0.0000011 </td>\n   <td style=\"text-align:center;\"> TRUE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> retail_full </td>\n   <td style=\"text-align:center;\"> I(std_t^2) </td>\n   <td style=\"text-align:center;\"> -0.0163208 </td>\n   <td style=\"text-align:center;\"> 0.0458329 </td>\n   <td style=\"text-align:center;\"> -0.3560935 </td>\n   <td style=\"text-align:center;\"> 0.7220097 </td>\n   <td style=\"text-align:center;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> retail_full </td>\n   <td style=\"text-align:center;\"> I(std_t^3) </td>\n   <td style=\"text-align:center;\"> -0.0102056 </td>\n   <td style=\"text-align:center;\"> 0.0178717 </td>\n   <td style=\"text-align:center;\"> -0.5710498 </td>\n   <td style=\"text-align:center;\"> 0.5683744 </td>\n   <td style=\"text-align:center;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> retail_full </td>\n   <td style=\"text-align:center;\"> sin1 </td>\n   <td style=\"text-align:center;\"> -0.0000252 </td>\n   <td style=\"text-align:center;\"> 0.0020362 </td>\n   <td style=\"text-align:center;\"> -0.0123921 </td>\n   <td style=\"text-align:center;\"> 0.9901207 </td>\n   <td style=\"text-align:center;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> retail_full </td>\n   <td style=\"text-align:center;\"> cos1 </td>\n   <td style=\"text-align:center;\"> -0.0360436 </td>\n   <td style=\"text-align:center;\"> 0.0020595 </td>\n   <td style=\"text-align:center;\"> -17.5008207 </td>\n   <td style=\"text-align:center;\"> 0.0000000 </td>\n   <td style=\"text-align:center;\"> TRUE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> retail_full </td>\n   <td style=\"text-align:center;\"> sin2 </td>\n   <td style=\"text-align:center;\"> -0.0037502 </td>\n   <td style=\"text-align:center;\"> 0.0020154 </td>\n   <td style=\"text-align:center;\"> -1.8607818 </td>\n   <td style=\"text-align:center;\"> 0.0637096 </td>\n   <td style=\"text-align:center;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> retail_full </td>\n   <td style=\"text-align:center;\"> cos2 </td>\n   <td style=\"text-align:center;\"> 0.0078111 </td>\n   <td style=\"text-align:center;\"> 0.0020169 </td>\n   <td style=\"text-align:center;\"> 3.8728011 </td>\n   <td style=\"text-align:center;\"> 0.0001309 </td>\n   <td style=\"text-align:center;\"> TRUE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> retail_full </td>\n   <td style=\"text-align:center;\"> sin3 </td>\n   <td style=\"text-align:center;\"> -0.0116397 </td>\n   <td style=\"text-align:center;\"> 0.0020098 </td>\n   <td style=\"text-align:center;\"> -5.7913822 </td>\n   <td style=\"text-align:center;\"> 0.0000000 </td>\n   <td style=\"text-align:center;\"> TRUE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> retail_full </td>\n   <td style=\"text-align:center;\"> cos3 </td>\n   <td style=\"text-align:center;\"> 0.0213598 </td>\n   <td style=\"text-align:center;\"> 0.0020189 </td>\n   <td style=\"text-align:center;\"> 10.5801523 </td>\n   <td style=\"text-align:center;\"> 0.0000000 </td>\n   <td style=\"text-align:center;\"> TRUE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> retail_full </td>\n   <td style=\"text-align:center;\"> sin4 </td>\n   <td style=\"text-align:center;\"> 0.0001229 </td>\n   <td style=\"text-align:center;\"> 0.0020100 </td>\n   <td style=\"text-align:center;\"> 0.0611468 </td>\n   <td style=\"text-align:center;\"> 0.9512812 </td>\n   <td style=\"text-align:center;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> retail_full </td>\n   <td style=\"text-align:center;\"> cos4 </td>\n   <td style=\"text-align:center;\"> 0.0101346 </td>\n   <td style=\"text-align:center;\"> 0.0020145 </td>\n   <td style=\"text-align:center;\"> 5.0308564 </td>\n   <td style=\"text-align:center;\"> 0.0000008 </td>\n   <td style=\"text-align:center;\"> TRUE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> retail_full </td>\n   <td style=\"text-align:center;\"> sin5 </td>\n   <td style=\"text-align:center;\"> 0.0277666 </td>\n   <td style=\"text-align:center;\"> 0.0020122 </td>\n   <td style=\"text-align:center;\"> 13.7990897 </td>\n   <td style=\"text-align:center;\"> 0.0000000 </td>\n   <td style=\"text-align:center;\"> TRUE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> retail_full </td>\n   <td style=\"text-align:center;\"> cos5 </td>\n   <td style=\"text-align:center;\"> 0.0203802 </td>\n   <td style=\"text-align:center;\"> 0.0020132 </td>\n   <td style=\"text-align:center;\"> 10.1232890 </td>\n   <td style=\"text-align:center;\"> 0.0000000 </td>\n   <td style=\"text-align:center;\"> TRUE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> retail_full </td>\n   <td style=\"text-align:center;\"> cos6 </td>\n   <td style=\"text-align:center;\"> 0.0038084 </td>\n   <td style=\"text-align:center;\"> 0.0014225 </td>\n   <td style=\"text-align:center;\"> 2.6772474 </td>\n   <td style=\"text-align:center;\"> 0.0078131 </td>\n   <td style=\"text-align:center;\"> TRUE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> retail_full </td>\n   <td style=\"text-align:center;\"> in_great_recession:std_t </td>\n   <td style=\"text-align:center;\"> -2.5718611 </td>\n   <td style=\"text-align:center;\"> 3.0873172 </td>\n   <td style=\"text-align:center;\"> -0.8330408 </td>\n   <td style=\"text-align:center;\"> 0.4054549 </td>\n   <td style=\"text-align:center;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> retail_full </td>\n   <td style=\"text-align:center;\"> std_t:after_great_recession </td>\n   <td style=\"text-align:center;\"> 0.0198043 </td>\n   <td style=\"text-align:center;\"> 0.1413695 </td>\n   <td style=\"text-align:center;\"> 0.1400891 </td>\n   <td style=\"text-align:center;\"> 0.8886794 </td>\n   <td style=\"text-align:center;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> retail_full </td>\n   <td style=\"text-align:center;\"> in_great_recession:I(std_t^2) </td>\n   <td style=\"text-align:center;\"> 14.8230840 </td>\n   <td style=\"text-align:center;\"> 24.4731229 </td>\n   <td style=\"text-align:center;\"> 0.6056883 </td>\n   <td style=\"text-align:center;\"> 0.5451593 </td>\n   <td style=\"text-align:center;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> retail_full </td>\n   <td style=\"text-align:center;\"> after_great_recession:I(std_t^2) </td>\n   <td style=\"text-align:center;\"> 0.1215930 </td>\n   <td style=\"text-align:center;\"> 0.1888445 </td>\n   <td style=\"text-align:center;\"> 0.6438792 </td>\n   <td style=\"text-align:center;\"> 0.5201238 </td>\n   <td style=\"text-align:center;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> retail_full </td>\n   <td style=\"text-align:center;\"> in_great_recession:I(std_t^3) </td>\n   <td style=\"text-align:center;\"> -35.1756536 </td>\n   <td style=\"text-align:center;\"> 60.1509944 </td>\n   <td style=\"text-align:center;\"> -0.5847892 </td>\n   <td style=\"text-align:center;\"> 0.5591094 </td>\n   <td style=\"text-align:center;\"> FALSE </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> retail_full </td>\n   <td style=\"text-align:center;\"> after_great_recession:I(std_t^3) </td>\n   <td style=\"text-align:center;\"> -0.0653848 </td>\n   <td style=\"text-align:center;\"> 0.0766366 </td>\n   <td style=\"text-align:center;\"> -0.8531788 </td>\n   <td style=\"text-align:center;\"> 0.3942105 </td>\n   <td style=\"text-align:center;\"> FALSE </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nretail_resid_df <- retail_final_lm |> \n  residuals() |> \n  as_tibble() |> \n  dplyr::select(.resid) |>\n  rename(x = .resid) \n  \nretail_resid_df |>\n  mutate(density = dnorm(x, mean(retail_resid_df$x), sd(retail_resid_df$x))) |>\n  ggplot(aes(x = x)) +\n    geom_histogram(aes(y = after_stat(density)),\n        color = \"white\", fill = \"#56B4E9\", binwidth = 0.02) +\n    geom_line(aes(x = x, y = density)) +\n    theme_bw() +\n    labs(\n      x = \"Values\",\n      y = \"Frequency\",\n      title = \"Histogram of Residuals\"\n    ) +\n    theme(\n      plot.title = element_text(hjust = 0.5)\n    )\n```\n\n::: {.cell-output-display}\n![Histogram of the residuals from the fitted regression model](chapter_6_lesson_2_files/figure-html/fig-HistogramOfResiduals-1.png){#fig-HistogramOfResiduals width=672}\n:::\n:::\n\n\n\n\nThe skewness is given by the command `skewness`:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nskewness(retail_resid_df$x)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.01014588\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nretail_final_lm |>\n  residuals() |>\n  ACF() |> \n  autoplot(var = .resid)\n```\n\n::: {.cell-output-display}\n![Correlogram of the residuals from the fitted regression model](chapter_6_lesson_2_files/figure-html/fig-acfOfResiduals-1.png){#fig-acfOfResiduals width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nretail_final_lm |>\n  residuals() |>\n  PACF() |> \n  autoplot(var = .resid)\n```\n\n::: {.cell-output-display}\n![Partial correlogram of the residuals from the fitted regression model](chapter_6_lesson_2_files/figure-html/fig-pacfOfResiduals-1.png){#fig-pacfOfResiduals width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n################################################################\n#   Be sure to adjust this model to match what you did above   #\n################################################################\n#\n# Model without any seasonal trends\nretail_no_seasonal_lm <- retail_ts |>\n  model(retail_full_quad = TSLM(log(sales_millions) ~  \n      (in_great_recession * std_t) + (after_great_recession * std_t) \n      + (in_great_recession * I(std_t^2) ) + (after_great_recession * I(std_t^2) )\n      + (in_great_recession * I(std_t^3) ) + (after_great_recession * I(std_t^3) )\n    )\n    )\n\nretail_ts |> \n  autoplot(.vars = sales_millions) +\n  # ggplot(mapping = aes(x = month, y = sales_millions)) +\n  # geom_line() +\n  geom_line(data = augment(retail_no_seasonal_lm),\n            aes(x = month, y = .fitted),\n            color = \"#E69F00\",\n            linewidth = 1\n            ) +\n  geom_line(data = augment(retail_final_lm),\n            aes(x = month, y = .fitted),\n            color = \"blue\",\n            alpha = 0.7,\n            # linewidth = 1\n            ) +\n  labs(\n    x = \"Month\",\n    y = \"Sales (Millions of U.S. Dollars)\",\n    title = paste0(retail_ts$business[1], \" (\", retail_ts$naics[1], \")\")\n  ) +\n  theme_minimal() +\n  theme(plot.title = element_text(hjust = 0.5))\n```\n\n::: {.cell-output-display}\n![Time plot of the retail sales data for full-service restaurants; the regression curve without the seasonal terms is given in orange; the predicted values from the model are given in blue](chapter_6_lesson_2_files/figure-html/fig-FittedModelPlottedOnTimePlot-1.png){#fig-FittedModelPlottedOnTimePlot width=672}\n:::\n:::\n\n::: {#tbl-ARMAmodelFitting .cell tbl-cap='Results from the process of fitting an ARMA model to the residuals of the model for the total sales in full-service restaurants in the United States'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nmodel_resid <- retail_final_lm |>\n  residuals() |>\n  select(-.model) |>\n  model(\n    auto = ARIMA(.resid ~ 1 + pdq(0:5,0,0:5) + PDQ(0, 0, 0)),\n    a000 = ARIMA(.resid ~ 1 + pdq(0,0,0) + PDQ(0, 0, 0)),\n    a001 = ARIMA(.resid ~ 1 + pdq(0,0,1) + PDQ(0, 0, 0)),\n    a002 = ARIMA(.resid ~ 1 + pdq(0,0,2) + PDQ(0, 0, 0)),\n    a003 = ARIMA(.resid ~ 1 + pdq(0,0,3) + PDQ(0, 0, 0)),\n    a004 = ARIMA(.resid ~ 1 + pdq(0,0,4) + PDQ(0, 0, 0)),\n    a005 = ARIMA(.resid ~ 1 + pdq(0,0,5) + PDQ(0, 0, 0)),\n    a100 = ARIMA(.resid ~ 1 + pdq(1,0,0) + PDQ(0, 0, 0)),\n    a101 = ARIMA(.resid ~ 1 + pdq(1,0,1) + PDQ(0, 0, 0)),\n    a102 = ARIMA(.resid ~ 1 + pdq(1,0,2) + PDQ(0, 0, 0)),\n    a103 = ARIMA(.resid ~ 1 + pdq(1,0,3) + PDQ(0, 0, 0)),\n    a104 = ARIMA(.resid ~ 1 + pdq(1,0,4) + PDQ(0, 0, 0)),\n    a105 = ARIMA(.resid ~ 1 + pdq(1,0,5) + PDQ(0, 0, 0)), \n    a200 = ARIMA(.resid ~ 1 + pdq(2,0,0) + PDQ(0, 0, 0)),\n    a201 = ARIMA(.resid ~ 1 + pdq(2,0,1) + PDQ(0, 0, 0)),\n    a202 = ARIMA(.resid ~ 1 + pdq(2,0,2) + PDQ(0, 0, 0)),\n    a203 = ARIMA(.resid ~ 1 + pdq(2,0,3) + PDQ(0, 0, 0)),\n    a204 = ARIMA(.resid ~ 1 + pdq(2,0,4) + PDQ(0, 0, 0)),\n    a205 = ARIMA(.resid ~ 1 + pdq(2,0,5) + PDQ(0, 0, 0)),\n    a300 = ARIMA(.resid ~ 1 + pdq(3,0,0) + PDQ(0, 0, 0)),\n    a301 = ARIMA(.resid ~ 1 + pdq(3,0,1) + PDQ(0, 0, 0)),\n    a302 = ARIMA(.resid ~ 1 + pdq(3,0,2) + PDQ(0, 0, 0)),\n    a303 = ARIMA(.resid ~ 1 + pdq(3,0,3) + PDQ(0, 0, 0)),\n    a304 = ARIMA(.resid ~ 1 + pdq(3,0,4) + PDQ(0, 0, 0)),\n    a305 = ARIMA(.resid ~ 1 + pdq(3,0,5) + PDQ(0, 0, 0)), \n    a400 = ARIMA(.resid ~ 1 + pdq(4,0,0) + PDQ(0, 0, 0)),\n    a401 = ARIMA(.resid ~ 1 + pdq(4,0,1) + PDQ(0, 0, 0)),\n    a402 = ARIMA(.resid ~ 1 + pdq(4,0,2) + PDQ(0, 0, 0)),\n    a403 = ARIMA(.resid ~ 1 + pdq(4,0,3) + PDQ(0, 0, 0)),\n    a404 = ARIMA(.resid ~ 1 + pdq(4,0,4) + PDQ(0, 0, 0)),\n    a405 = ARIMA(.resid ~ 1 + pdq(4,0,5) + PDQ(0, 0, 0)),\n    a500 = ARIMA(.resid ~ 1 + pdq(5,0,0) + PDQ(0, 0, 0)),\n    a501 = ARIMA(.resid ~ 1 + pdq(5,0,1) + PDQ(0, 0, 0)),\n    a502 = ARIMA(.resid ~ 1 + pdq(5,0,2) + PDQ(0, 0, 0)),\n    a503 = ARIMA(.resid ~ 1 + pdq(5,0,3) + PDQ(0, 0, 0)),\n    a504 = ARIMA(.resid ~ 1 + pdq(5,0,4) + PDQ(0, 0, 0)),\n    a505 = ARIMA(.resid ~ 1 + pdq(5,0,5) + PDQ(0, 0, 0))\n  )\n\n\n# This command indicates which model was selected by \"auto\"\n# model_resid |> select(auto)\n\nmodel_resid |> \n  glance() |>\n  # uncomment the next line to only show the \"best\" models according to these criteria\n  # filter(AIC == min(AIC) | AICc == min(AICc) | BIC == min(BIC) | .model == \"auto\") |>\n  knitr::kable(format = \"html\", align='ccccccc', escape = FALSE, width = NA, row.names = FALSE) |>\n  kable_styling(full_width = FALSE, \"striped\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:center;\"> .model </th>\n   <th style=\"text-align:center;\"> sigma2 </th>\n   <th style=\"text-align:center;\"> log_lik </th>\n   <th style=\"text-align:center;\"> AIC </th>\n   <th style=\"text-align:center;\"> AICc </th>\n   <th style=\"text-align:center;\"> BIC </th>\n   <th style=\"text-align:center;\"> ar_roots </th>\n   <th style=\"text-align:center;\"> ma_roots </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> auto </td>\n   <td style=\"text-align:center;\"> 0.0003644 </td>\n   <td style=\"text-align:center;\"> 841.5138 </td>\n   <td style=\"text-align:center;\"> -1667.028 </td>\n   <td style=\"text-align:center;\"> -1666.631 </td>\n   <td style=\"text-align:center;\"> -1635.677 </td>\n   <td style=\"text-align:center;\"> -0.5762646+0.8613026i, -0.5762646-0.8613026i, 2.2627735-0.8408307i, 2.2627735+0.8408307i </td>\n   <td style=\"text-align:center;\"> -0.5154592+0.9948076i, -0.5154592-0.9948076i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a000 </td>\n   <td style=\"text-align:center;\"> 0.0005764 </td>\n   <td style=\"text-align:center;\"> 762.4127 </td>\n   <td style=\"text-align:center;\"> -1520.825 </td>\n   <td style=\"text-align:center;\"> -1520.793 </td>\n   <td style=\"text-align:center;\"> -1512.988 </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a001 </td>\n   <td style=\"text-align:center;\"> 0.0004803 </td>\n   <td style=\"text-align:center;\"> 793.5159 </td>\n   <td style=\"text-align:center;\"> -1581.032 </td>\n   <td style=\"text-align:center;\"> -1580.966 </td>\n   <td style=\"text-align:center;\"> -1569.275 </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> -2.382155+0i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a002 </td>\n   <td style=\"text-align:center;\"> 0.0004782 </td>\n   <td style=\"text-align:center;\"> 794.7146 </td>\n   <td style=\"text-align:center;\"> -1581.429 </td>\n   <td style=\"text-align:center;\"> -1581.320 </td>\n   <td style=\"text-align:center;\"> -1565.754 </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> -1.822802+2.494324i, -1.822802-2.494324i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a003 </td>\n   <td style=\"text-align:center;\"> 0.0004109 </td>\n   <td style=\"text-align:center;\"> 820.4694 </td>\n   <td style=\"text-align:center;\"> -1630.939 </td>\n   <td style=\"text-align:center;\"> -1630.775 </td>\n   <td style=\"text-align:center;\"> -1611.344 </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> 0.232624+1.346072i, -1.379822+0.000000i, 0.232624-1.346072i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a004 </td>\n   <td style=\"text-align:center;\"> 0.0004086 </td>\n   <td style=\"text-align:center;\"> 821.8842 </td>\n   <td style=\"text-align:center;\"> -1631.768 </td>\n   <td style=\"text-align:center;\"> -1631.538 </td>\n   <td style=\"text-align:center;\"> -1608.255 </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> 0.090446+1.334121i, -1.288012-0.000000i, 0.090446-1.334121i, 4.263380+0.000000i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a005 </td>\n   <td style=\"text-align:center;\"> 0.0004097 </td>\n   <td style=\"text-align:center;\"> 821.8871 </td>\n   <td style=\"text-align:center;\"> -1629.774 </td>\n   <td style=\"text-align:center;\"> -1629.466 </td>\n   <td style=\"text-align:center;\"> -1602.342 </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> 0.096742+1.327683i, -1.295555-0.000000i, 0.096742-1.327683i, 3.658704-0.000000i, -19.273408-0.000000i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a100 </td>\n   <td style=\"text-align:center;\"> 0.0004615 </td>\n   <td style=\"text-align:center;\"> 800.2336 </td>\n   <td style=\"text-align:center;\"> -1594.467 </td>\n   <td style=\"text-align:center;\"> -1594.402 </td>\n   <td style=\"text-align:center;\"> -1582.710 </td>\n   <td style=\"text-align:center;\"> 2.220227+0i </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a101 </td>\n   <td style=\"text-align:center;\"> 0.0004590 </td>\n   <td style=\"text-align:center;\"> 801.5727 </td>\n   <td style=\"text-align:center;\"> -1595.145 </td>\n   <td style=\"text-align:center;\"> -1595.036 </td>\n   <td style=\"text-align:center;\"> -1579.470 </td>\n   <td style=\"text-align:center;\"> 1.709493+0i </td>\n   <td style=\"text-align:center;\"> 6.008737+0i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a102 </td>\n   <td style=\"text-align:center;\"> 0.0004537 </td>\n   <td style=\"text-align:center;\"> 803.9495 </td>\n   <td style=\"text-align:center;\"> -1597.899 </td>\n   <td style=\"text-align:center;\"> -1597.735 </td>\n   <td style=\"text-align:center;\"> -1578.305 </td>\n   <td style=\"text-align:center;\"> 2.092518+0i </td>\n   <td style=\"text-align:center;\"> 0.291385+2.033057i, 0.291385-2.033057i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a103 </td>\n   <td style=\"text-align:center;\"> 0.0004091 </td>\n   <td style=\"text-align:center;\"> 821.6652 </td>\n   <td style=\"text-align:center;\"> -1631.330 </td>\n   <td style=\"text-align:center;\"> -1631.100 </td>\n   <td style=\"text-align:center;\"> -1607.817 </td>\n   <td style=\"text-align:center;\"> -4.593936+0i </td>\n   <td style=\"text-align:center;\"> 0.114692+1.365411i, -1.273789-0.000000i, 0.114692-1.365411i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a104 </td>\n   <td style=\"text-align:center;\"> 0.0003923 </td>\n   <td style=\"text-align:center;\"> 827.7659 </td>\n   <td style=\"text-align:center;\"> -1641.532 </td>\n   <td style=\"text-align:center;\"> -1641.224 </td>\n   <td style=\"text-align:center;\"> -1614.100 </td>\n   <td style=\"text-align:center;\"> 1.114879+0i </td>\n   <td style=\"text-align:center;\"> 0.202209+1.31577i, 0.202209-1.31577i, 1.000001+0.00000i, -1.352297-0.00000i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a105 </td>\n   <td style=\"text-align:center;\"> 0.0003929 </td>\n   <td style=\"text-align:center;\"> 828.0239 </td>\n   <td style=\"text-align:center;\"> -1640.048 </td>\n   <td style=\"text-align:center;\"> -1639.651 </td>\n   <td style=\"text-align:center;\"> -1608.697 </td>\n   <td style=\"text-align:center;\"> 1.103023+0i </td>\n   <td style=\"text-align:center;\"> 1.000002-0.000000i, -1.312010+0.000000i, 0.146005-1.323116i, 0.146005+1.323116i, 9.340950+0.000000i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a200 </td>\n   <td style=\"text-align:center;\"> 0.0004586 </td>\n   <td style=\"text-align:center;\"> 801.7290 </td>\n   <td style=\"text-align:center;\"> -1595.458 </td>\n   <td style=\"text-align:center;\"> -1595.349 </td>\n   <td style=\"text-align:center;\"> -1579.782 </td>\n   <td style=\"text-align:center;\"> 1.741604+0i, -6.053939+0i </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a201 </td>\n   <td style=\"text-align:center;\"> 0.0004597 </td>\n   <td style=\"text-align:center;\"> 801.7718 </td>\n   <td style=\"text-align:center;\"> -1593.544 </td>\n   <td style=\"text-align:center;\"> -1593.380 </td>\n   <td style=\"text-align:center;\"> -1573.949 </td>\n   <td style=\"text-align:center;\"> 1.707303+0i, -8.322029+0i </td>\n   <td style=\"text-align:center;\"> 17.35635+0i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a202 </td>\n   <td style=\"text-align:center;\"> 0.0004424 </td>\n   <td style=\"text-align:center;\"> 808.6177 </td>\n   <td style=\"text-align:center;\"> -1605.235 </td>\n   <td style=\"text-align:center;\"> -1605.005 </td>\n   <td style=\"text-align:center;\"> -1581.722 </td>\n   <td style=\"text-align:center;\"> 1.11252+1.235597i, 1.11252-1.235597i </td>\n   <td style=\"text-align:center;\"> 0.478362+1.381186i, 0.478362-1.381186i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a203 </td>\n   <td style=\"text-align:center;\"> 0.0004020 </td>\n   <td style=\"text-align:center;\"> 824.8516 </td>\n   <td style=\"text-align:center;\"> -1635.703 </td>\n   <td style=\"text-align:center;\"> -1635.395 </td>\n   <td style=\"text-align:center;\"> -1608.271 </td>\n   <td style=\"text-align:center;\"> -0.603528+1.04516i, -0.603528-1.04516i </td>\n   <td style=\"text-align:center;\"> -0.341680+1.04375i, -1.490094-0.00000i, -0.341680-1.04375i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a204 </td>\n   <td style=\"text-align:center;\"> 0.0003928 </td>\n   <td style=\"text-align:center;\"> 828.0543 </td>\n   <td style=\"text-align:center;\"> -1640.109 </td>\n   <td style=\"text-align:center;\"> -1639.712 </td>\n   <td style=\"text-align:center;\"> -1608.757 </td>\n   <td style=\"text-align:center;\"> 1.103352+0i, -8.074288+0i </td>\n   <td style=\"text-align:center;\"> 1.000000+0.00000i, -1.299607-0.00000i, 0.140388-1.33086i, 0.140388+1.33086i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a205 </td>\n   <td style=\"text-align:center;\"> 0.0003944 </td>\n   <td style=\"text-align:center;\"> 827.7675 </td>\n   <td style=\"text-align:center;\"> -1637.535 </td>\n   <td style=\"text-align:center;\"> -1637.038 </td>\n   <td style=\"text-align:center;\"> -1602.265 </td>\n   <td style=\"text-align:center;\"> 1.114557+0i, -1.380078+0i </td>\n   <td style=\"text-align:center;\"> 1.000000+0.000000i, -1.304935+0.000000i, 0.200885-1.317038i, 0.200885+1.317038i, -1.439098+0.000000i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a300 </td>\n   <td style=\"text-align:center;\"> 0.0004588 </td>\n   <td style=\"text-align:center;\"> 802.1164 </td>\n   <td style=\"text-align:center;\"> -1594.233 </td>\n   <td style=\"text-align:center;\"> -1594.069 </td>\n   <td style=\"text-align:center;\"> -1574.638 </td>\n   <td style=\"text-align:center;\"> 1.561490-0.000000i, -1.559974+3.283859i, -1.559974-3.283859i </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a301 </td>\n   <td style=\"text-align:center;\"> 0.0004395 </td>\n   <td style=\"text-align:center;\"> 809.7261 </td>\n   <td style=\"text-align:center;\"> -1607.452 </td>\n   <td style=\"text-align:center;\"> -1607.222 </td>\n   <td style=\"text-align:center;\"> -1583.939 </td>\n   <td style=\"text-align:center;\"> 1.489169-0.000000i, -1.438632+0.982914i, -1.438632-0.982914i </td>\n   <td style=\"text-align:center;\"> -1.421429+0i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a302 </td>\n   <td style=\"text-align:center;\"> 0.0003535 </td>\n   <td style=\"text-align:center;\"> 844.0552 </td>\n   <td style=\"text-align:center;\"> -1674.110 </td>\n   <td style=\"text-align:center;\"> -1673.803 </td>\n   <td style=\"text-align:center;\"> -1646.678 </td>\n   <td style=\"text-align:center;\"> -0.5774684+0.8165105i, -0.5774684-0.8165105i, 1.7298070-0.0000000i </td>\n   <td style=\"text-align:center;\"> -0.5791569+0.8214568i, -0.5791569-0.8214568i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a303 </td>\n   <td style=\"text-align:center;\"> 0.0003668 </td>\n   <td style=\"text-align:center;\"> 840.4061 </td>\n   <td style=\"text-align:center;\"> -1664.812 </td>\n   <td style=\"text-align:center;\"> -1664.416 </td>\n   <td style=\"text-align:center;\"> -1633.461 </td>\n   <td style=\"text-align:center;\"> -0.5727277+0.8592709i, -0.5727277-0.8592709i, 1.7714851-0.0000000i </td>\n   <td style=\"text-align:center;\"> -0.5205722+0.9760787i, -0.5205722-0.9760787i, -6.1372611-0.0000000i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a304 </td>\n   <td style=\"text-align:center;\"> 0.0003475 </td>\n   <td style=\"text-align:center;\"> 849.1941 </td>\n   <td style=\"text-align:center;\"> -1680.388 </td>\n   <td style=\"text-align:center;\"> -1679.891 </td>\n   <td style=\"text-align:center;\"> -1645.118 </td>\n   <td style=\"text-align:center;\"> -0.5791893+0.8188125i, -0.5791893-0.8188125i, 2.5938880+0.0000000i </td>\n   <td style=\"text-align:center;\"> -0.6126397+0.8363729i, -0.6126397-0.8363729i, -0.2481793-1.7853598i, -0.2481793+1.7853598i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a305 </td>\n   <td style=\"text-align:center;\"> 0.0003467 </td>\n   <td style=\"text-align:center;\"> 849.2092 </td>\n   <td style=\"text-align:center;\"> -1678.418 </td>\n   <td style=\"text-align:center;\"> -1677.809 </td>\n   <td style=\"text-align:center;\"> -1639.230 </td>\n   <td style=\"text-align:center;\"> 1.0685664-0.0000000i, -0.5815414+0.8262367i, -0.5815414-0.8262367i </td>\n   <td style=\"text-align:center;\"> 1.0000003-0.000000i, -0.6708443+0.861622i, -0.6708443-0.861622i, -0.4789438-1.295557i, -0.4789438+1.295557i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a400 </td>\n   <td style=\"text-align:center;\"> 0.0003926 </td>\n   <td style=\"text-align:center;\"> 828.4866 </td>\n   <td style=\"text-align:center;\"> -1644.973 </td>\n   <td style=\"text-align:center;\"> -1644.743 </td>\n   <td style=\"text-align:center;\"> -1621.460 </td>\n   <td style=\"text-align:center;\"> 1.074908+0.622598i, -0.815559+1.008846i, -0.815559-1.008846i, 1.074908-0.622598i </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a401 </td>\n   <td style=\"text-align:center;\"> 0.0003936 </td>\n   <td style=\"text-align:center;\"> 828.5076 </td>\n   <td style=\"text-align:center;\"> -1643.015 </td>\n   <td style=\"text-align:center;\"> -1642.707 </td>\n   <td style=\"text-align:center;\"> -1615.583 </td>\n   <td style=\"text-align:center;\"> 1.079994+0.6285086i, -0.818089+0.9991499i, -0.818089-0.9991499i, 1.079994-0.6285086i </td>\n   <td style=\"text-align:center;\"> -39.24509+0i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a402 </td>\n   <td style=\"text-align:center;\"> 0.0003644 </td>\n   <td style=\"text-align:center;\"> 841.5138 </td>\n   <td style=\"text-align:center;\"> -1667.028 </td>\n   <td style=\"text-align:center;\"> -1666.631 </td>\n   <td style=\"text-align:center;\"> -1635.677 </td>\n   <td style=\"text-align:center;\"> -0.5762646+0.8613026i, -0.5762646-0.8613026i, 2.2627735-0.8408307i, 2.2627735+0.8408307i </td>\n   <td style=\"text-align:center;\"> -0.5154592+0.9948076i, -0.5154592-0.9948076i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a403 </td>\n   <td style=\"text-align:center;\"> 0.0003546 </td>\n   <td style=\"text-align:center;\"> 846.4790 </td>\n   <td style=\"text-align:center;\"> -1674.958 </td>\n   <td style=\"text-align:center;\"> -1674.461 </td>\n   <td style=\"text-align:center;\"> -1639.688 </td>\n   <td style=\"text-align:center;\"> 1.192965+0.5326171i, -0.576099+0.8530305i, -0.576099-0.8530305i, 1.192965-0.5326171i </td>\n   <td style=\"text-align:center;\"> -0.5438287+0.9807507i, -0.5438287-0.9807507i, 1.5196159+0.0000000i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a404 </td>\n   <td style=\"text-align:center;\"> 0.0003349 </td>\n   <td style=\"text-align:center;\"> 854.9148 </td>\n   <td style=\"text-align:center;\"> -1689.830 </td>\n   <td style=\"text-align:center;\"> -1689.220 </td>\n   <td style=\"text-align:center;\"> -1650.641 </td>\n   <td style=\"text-align:center;\"> 1.0067552+0.5651317i, -0.5776288+0.8165889i, -0.5776288-0.8165889i, 1.0067552-0.5651317i </td>\n   <td style=\"text-align:center;\"> 1.2962822+0.9424546i, -0.5840364+0.8220893i, -0.5840364-0.8220893i, 1.2962822-0.9424546i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a405 </td>\n   <td style=\"text-align:center;\"> 0.0003282 </td>\n   <td style=\"text-align:center;\"> 859.1482 </td>\n   <td style=\"text-align:center;\"> -1696.296 </td>\n   <td style=\"text-align:center;\"> -1695.563 </td>\n   <td style=\"text-align:center;\"> -1653.189 </td>\n   <td style=\"text-align:center;\"> 0.8764700+0.5283505i, -0.5780574+0.8170427i, -0.5780574-0.8170427i, 0.8764700-0.5283505i </td>\n   <td style=\"text-align:center;\"> 0.8854442+0.6218356i, -0.5844324+0.8275889i, -0.5844324-0.8275889i, 0.8854442-0.6218356i, -3.5686492+0.0000000i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a500 </td>\n   <td style=\"text-align:center;\"> 0.0003936 </td>\n   <td style=\"text-align:center;\"> 828.5134 </td>\n   <td style=\"text-align:center;\"> -1643.027 </td>\n   <td style=\"text-align:center;\"> -1642.719 </td>\n   <td style=\"text-align:center;\"> -1615.595 </td>\n   <td style=\"text-align:center;\"> 1.0816019+0.630746i, -0.8181991+0.996680i, -0.8181991-0.996680i, 1.0816019-0.630746i, 30.0866777+0.000000i </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a501 </td>\n   <td style=\"text-align:center;\"> 0.0003943 </td>\n   <td style=\"text-align:center;\"> 828.6939 </td>\n   <td style=\"text-align:center;\"> -1641.388 </td>\n   <td style=\"text-align:center;\"> -1640.991 </td>\n   <td style=\"text-align:center;\"> -1610.037 </td>\n   <td style=\"text-align:center;\"> 1.063879+0.614274i, -0.782909+1.024026i, -0.782909-1.024026i, 1.063879-0.614274i, -1.633662-0.000000i </td>\n   <td style=\"text-align:center;\"> -1.791808+0i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a502 </td>\n   <td style=\"text-align:center;\"> 0.0003465 </td>\n   <td style=\"text-align:center;\"> 849.6644 </td>\n   <td style=\"text-align:center;\"> -1681.329 </td>\n   <td style=\"text-align:center;\"> -1680.832 </td>\n   <td style=\"text-align:center;\"> -1646.059 </td>\n   <td style=\"text-align:center;\"> 1.3231535+0.8089297i, -0.5790055+0.8187047i, -0.5790055-0.8187047i, 1.3231535-0.8089297i, -1.8902606+0.0000000i </td>\n   <td style=\"text-align:center;\"> -0.6099102+0.8427657i, -0.6099102-0.8427657i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a503 </td>\n   <td style=\"text-align:center;\"> 0.0003371 </td>\n   <td style=\"text-align:center;\"> 853.7740 </td>\n   <td style=\"text-align:center;\"> -1687.548 </td>\n   <td style=\"text-align:center;\"> -1686.939 </td>\n   <td style=\"text-align:center;\"> -1648.359 </td>\n   <td style=\"text-align:center;\"> 1.1212944+0.5571492i, -0.5777218+0.8165442i, -0.5777218-0.8165442i, 1.1212944-0.5571492i, -2.8445945-0.0000000i </td>\n   <td style=\"text-align:center;\"> -0.5853707+0.822848i, -0.5853707-0.822848i, 1.8347464-0.000000i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a504 </td>\n   <td style=\"text-align:center;\"> 0.0003174 </td>\n   <td style=\"text-align:center;\"> 863.4734 </td>\n   <td style=\"text-align:center;\"> -1704.947 </td>\n   <td style=\"text-align:center;\"> -1704.214 </td>\n   <td style=\"text-align:center;\"> -1661.839 </td>\n   <td style=\"text-align:center;\"> 0.8683242+0.5235239i, -0.5775260+0.8164740i, -0.5775260-0.8164740i, 0.8683242-0.5235239i, 2.5819016+0.0000000i </td>\n   <td style=\"text-align:center;\"> 0.8814016+0.5774634i, -0.5799805+0.8211971i, -0.5799805-0.8211971i, 0.8814016-0.5774634i </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> a505 </td>\n   <td style=\"text-align:center;\"> 0.0003172 </td>\n   <td style=\"text-align:center;\"> 864.3575 </td>\n   <td style=\"text-align:center;\"> -1704.715 </td>\n   <td style=\"text-align:center;\"> -1703.846 </td>\n   <td style=\"text-align:center;\"> -1657.688 </td>\n   <td style=\"text-align:center;\"> 0.8686868+0.5163216i, -0.5776237+0.8164885i, -0.5776237-0.8164885i, 0.8686868-0.5163216i, 1.6856268-0.0000000i </td>\n   <td style=\"text-align:center;\"> 0.8977736+0.5532624i, -0.5820940+0.8217810i, -0.5820940-0.8217810i, 0.8977736-0.5532624i, 4.7797944+0.0000000i </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nmodel_resid |>\n  select(a504) |>\n  residuals() |>\n  ACF() |> \n  autoplot(var = .resid)\n```\n\n::: {.cell-output-display}\n![Correlogram of the residuals from the ARMA model fitted to the residuals from the regression model](chapter_6_lesson_2_files/figure-html/fig-acfOfResidualsFromArmaModelOnTheResiduals-1.png){#fig-acfOfResidualsFromArmaModelOnTheResiduals width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\nmodel_resid |>\n  select(a504) |>\n  residuals() |>\n  PACF() |> \n  autoplot(var = .resid)\n```\n\n::: {.cell-output-display}\n![Partial correlogram of the residuals from the ARMA model fitted to the residuals from the regression model](chapter_6_lesson_2_files/figure-html/fig-pacfOfResidualsFromArmaModelOnTheResiduals-1.png){#fig-pacfOfResidualsFromArmaModelOnTheResiduals width=672}\n:::\n:::\n",
    "supporting": [
      "chapter_6_lesson_2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}