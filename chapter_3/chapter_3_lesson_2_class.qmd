---
title: "Exponential Smoothing"
subtitle: "Chapter 3: Lesson 3"
format: html
editor: source
sidebar: false
---

```{r}
#| include: false
source("../common_functions.R")
```

```{=html}
<script type="text/javascript">
 function showhide(id) {
    var e = document.getElementById(id);
    e.style.display = (e.style.display == 'block') ? 'none' : 'block';
 }
 
 function openTab(evt, tabName) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " active";
 }    
</script>
```

## Learning Outcomes

<details>    
<summary>Implement simple exponential smoothing to estimate local mean levels</summary>
    -   Explain forecasting by extrapolation 
    -   State the assumptions of exponential smoothing
    -   Define exponential weighted moving average (EWMA)
    -   State the exponential smoothing forecasting equation
    -   State the EWMA in geometric series form (in terms of x_t only Eq 3.18)
    -   Explain the EWMA intuitively
    -   Define the one-step-ahead prediction error (1PE)
    -   State the SS1PE used to estimate the smoothing parameter of a EWMA
    -   Indicate when the EWMA smoothing parameter is optimally set as 1/n
</details>


## Preparation

-   Read Section 3.4.1


## Learning Journal Exchange (10 mins)

-   Review another student's journal

-   What would you add to your learning journal after reading another student's?

-   What would you recommend the other student add to their learning journal?

-   Sign the Learning Journal review sheet for your peer


## Class Activity: Highway Speeds in New York City (45 mins)

The Bruckner Expressway (I-278) cuts through the Bronx in New York City. Traffic sensors record the speed of cars every 5 minutes between Stratford Avenue and Castle Hill Avenue. The data from 4/15/2022 to 5/16/2022 are contained in the file <a href="../data/ny_speeds.csv" download>ny_speeds.csv</a>. 
(Source: City of New York Department of Transportation. Online Links: 
[http://a841‚Äêdotweb01.nyc.gov/datafeeds](https://data.beta.nyc/dataset/nyc-real-time-traffic-speed-data-feed-archived)
These dates were selected, because they provided uninterrupted consecutive measurements.

We will read these files into a tsibble.

```{r}
# Read the ny_speeds data
ny_speeds_dat <- rio::import("../data/ny_speeds.csv")

three_min <- mdy_hm("1/1/2000 12:03") - mdy_hm("1/1/2000 12:00")

ny_speeds_tb <- ny_speeds_dat |>
  mutate(
    dates = mdy_hms(DataAsOf), # - three_min,
    dates = round_date(dates, "minute"),
    # dates = round_date(dates, "5 mins"),
    year = lubridate::year(dates),
    month = lubridate::month(dates),
  ) %>%
  rename(speed = Speed) |>
  dplyr::select(-Id, -TravelTime, -Status, -DataAsOf, -linkId) |>
  tibble()

# not working commented it out so I could push hw edits
# ny_speeds_ts <- ny_speeds_tb |>
#   mutate(index = dates) |>
#   as_tsibble(index = index)
```


```{r}
```

```{r}
#| warning: false

# ny_speeds_decompose <- ny_speeds_ts |>
#     model(feasts::classical_decomposition(speed,
#         type = "add"))  |>
#     components()
# 
# autoplot(choc_decompose)
```

## Recap (5 min)

Working with your partner, prepare to explain the following concepts to the class:



<a href="javascript:showhide('Solutions')"
style="font-size:.8em;">Class Activity</a>

::: {#Solutions style="display:none;"}

Solutions to Class Activity

```{r}
#| echo: false
stuff <- "here"
```

:::