---
title: "Exponential Smoothing"
subtitle: "Chapter 3: Lesson 2"
format: html
editor: source
sidebar: false
---

```{r}
#| include: false
source("../common_functions.R")
```

```{=html}
<script type="text/javascript">
 function showhide(id) {
    var e = document.getElementById(id);
    e.style.display = (e.style.display == 'block') ? 'none' : 'block';
 }
 
 function openTab(evt, tabName) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " active";
 }    
</script>
```

## Learning Outcomes

<details>    
<summary>Implement simple exponential smoothing to estimate local mean levels</summary>
    -   Explain forecasting by extrapolation 
    -   State the assumptions of exponential smoothing
    -   Define exponential weighted moving average (EWMA)
    -   State the exponential smoothing forecasting equation
    -   State the EWMA in geometric series form (in terms of x_t only Eq 3.18)
    -   Explain the EWMA intuitively
    -   Define the one-step-ahead prediction error (1PE)
    -   State the SS1PE used to estimate the smoothing parameter of a EWMA
    -   Indicate when the EWMA smoothing parameter is optimally set as 1/n
</details>


## Preparation

-   Read Section 3.4.1


## Learning Journal Exchange (10 mins)

-   Review another student's journal

-   What would you add to your learning journal after reading another student's?

-   What would you recommend the other student add to their learning journal?

-   Sign the Learning Journal review sheet for your peer


## Class Activity: Highway Speeds in New York City (45 mins)

:::: {.columns}

::: {.column width="45%"}
The Bruckner Expressway (I-278) cuts through the Bronx in New York City. Traffic sensors record the speed of cars every 5 minutes between Stratford Avenue and Castle Hill Avenue. 
:::

::: {.column width="10%"}
<!-- empty column to create gap -->
:::

::: {.column width="45%"}
![Google Map showing the location of the data collection.](../images/ny_speed_google_map_small.png)
:::

::::

The data from 7/2/2022 to 7/22/2022 are contained in the file <a href="../data/ny_speeds.csv" download>ny_speeds.csv</a>.
(Source: City of New York Department of Transportation. Online Links: 
[http://a841‚Äêdotweb01.nyc.gov/datafeeds](https://data.beta.nyc/dataset/nyc-real-time-traffic-speed-data-feed-archived)
These data have been cleaned to align the observations with precise five minute intervals.

We will read these files into a tsibble.

```{r}
# Read the ny_speeds data
ny_speeds_dat <- rio::import("../data/ny_speeds.csv")

ny_speeds_tb <- ny_speeds_dat |>
  mutate(
    year = lubridate::year(date),
    month = lubridate::month(date),
    #
    day = lubridate::day(date),
    hour = lubridate::hour(date),
    min = lubridate::minute(date)
  ) |>
  rename(speed = Speed) |>
  dplyr::select(-Id, -TravelTime, -Status, -DataAsOf, -linkId) |>
  #
  # Limit the number of days
  filter(date >= mdy("7/2/2022") & date < mdy("7/18/2022")) |>
  tibble()

ny_speeds_ts <- ny_speeds_tb |>
  mutate(index = date) |>
  as_tsibble(index = index)

# ny_speeds_ts |> head
```


```{r}
#| warning: false

ny_speeds_decompose <- ny_speeds_ts |>
    model(feasts::classical_decomposition(speed ~ season(60/5*24),
        type = "add"))  |>
    components()

autoplot(ny_speeds_decompose)
```

```{r}
speed_plot <- ny_speeds_decompose |> 
  filter((index) <= mdy_hm("7/3/2022 12:00")) |> 
  na.omit() |> 
  dplyr::select(speed) |> 
  autoplot(.vars = speed)
rand_plot <- ny_speeds_decompose |> 
  filter((index) <= mdy_hm("7/3/2022 12:00")) |> 
  na.omit() |> 
  dplyr::select(random) |> 
  autoplot(.vars = random)

speed_plot / rand_plot
```





## Recap (5 min)

Working with your partner, prepare to explain the following concepts to the class:



<a href="javascript:showhide('Solutions')"
style="font-size:.8em;">Class Activity</a>

::: {#Solutions style="display:none;"}

Solutions to Class Activity

```{r}
#| echo: false
stuff <- "here"
```

:::