{
  "hash": "40287b93016cf9fdb8fe20a642fa4636",
  "result": {
    "markdown": "---\ntitle: \"Exponential Smoothing\"\nsubtitle: \"Chapter 3: Lesson 2\"\nformat: html\neditor: source\nsidebar: false\n---\n\n\n\n```{=html}\n<script type=\"text/javascript\">\n function showhide(id) {\n    var e = document.getElementById(id);\n    e.style.display = (e.style.display == 'block') ? 'none' : 'block';\n }\n \n function openTab(evt, tabName) {\n    var i, tabcontent, tablinks;\n    tabcontent = document.getElementsByClassName(\"tabcontent\");\n    for (i = 0; i < tabcontent.length; i++) {\n        tabcontent[i].style.display = \"none\";\n    }\n    tablinks = document.getElementsByClassName(\"tablinks\");\n    for (i = 0; i < tablinks.length; i++) {\n        tablinks[i].className = tablinks[i].className.replace(\" active\", \"\");\n    }\n    document.getElementById(tabName).style.display = \"block\";\n    evt.currentTarget.className += \" active\";\n }    \n</script>\n```\n\n\n## Learning Outcomes\n\n<details>    \n<summary>Implement simple exponential smoothing to estimate local mean levels</summary>\n    -   Explain forecasting by extrapolation \n    -   State the assumptions of exponential smoothing\n    -   Define exponential weighted moving average (EWMA)\n    -   State the exponential smoothing forecasting equation\n    -   State the EWMA in geometric series form (in terms of x_t only Eq 3.18)\n    -   Explain the EWMA intuitively\n    -   Define the one-step-ahead prediction error (1PE)\n    -   State the SS1PE used to estimate the smoothing parameter of a EWMA\n    -   Indicate when the EWMA smoothing parameter is optimally set as 1/n\n</details>\n\n\n## Preparation\n\n-   Read Section 3.4.1\n\n\n## Learning Journal Exchange (10 mins)\n\n-   Review another student's journal\n\n-   What would you add to your learning journal after reading another student's?\n\n-   What would you recommend the other student add to their learning journal?\n\n-   Sign the Learning Journal review sheet for your peer\n\n\n## Class Discussion: Theory Supporting the EWMA\n\nOur objective is to predict a future value given the first $n$ observations of a time series. One example would be to forecast sales of an existing product in a stable market.\n\nWe assume the following about the time series:\n\n-   There is no systematic trend or seasonal effects (or that these have been removed).\n\n-   The mean is non-stationary (can change), but we have no idea about the direction.\n\n::: {.callout-tip icon=false title=\"Check Your Understanding\"}\n\nMatch the following definitions to the appropriate term.\n\n:::: {style=\"display: flex;\"}\n<div>\n\n1.  A future observation of a time series\n2.  Model assumed in EWMA agorithm\n3.  Non-stationary mean\n4.  Random correlated error terms\n5.  A fixed constant between 0 and 1\n</div>\n\n<div>\nA.  $\\alpha$\nB.  $\\mu_t$\nC.  $w_t$\nD.  $x_{n+k}$\nE.  $x_t = \\mu_t + w_t$\n</div>\n::::\n\n:::\n\nThe idea is that we will use past observations to predict future observations. Our best prediction of future observations under this model is the mean of the estimate at the time of the last observation. In symbols, if we want to predict the value of the time series at time $n+k$, we use our estimate of the time series at time $n$: \n\n$$\n\\hat x_{n+k \\mid n} = a_n, ~~~~~~~~~~~~~~~~~~\\text{where}~~ k = 1, 2, 3, \\ldots ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ (3.16)\n$$\nHere are three equivalent expressions that define the EWMA estimation technique:\n\n\\begin{align}\n  a_t &= \\alpha x_t + (1-\\alpha) a_{t+1} & (3.15) \\\\\n  a_t &= \\alpha (x_t - a_{t-1} ) + a_{t-1} & (3.17) \\\\\n  a_t &= \\alpha x_t + \\alpha(1-\\alpha) x_{t-1} + \\alpha(1-\\alpha)^2 x_{t-2} + \\alpha(1-\\alpha)^3 x_{t-3} + \\cdots & (3.18) \n\\end{align}\n\nWe assume that $a_1 = x_1$.\n\n::: {.callout-tip icon=false title=\"Check Your Understanding\"}\n\n-   What happens if $\\alpha$ is close to 1?\n-   What happens if $\\alpha$ is close to 0?\n-   What is a common \"compromise\" value for $\\alpha$?\n-   Show that Equation (3.15) and (3.17) are equivalent.\n-   How would you show that Equation (3.18) is equivalent to Equation (3.17)?\n\n:::\n\n\n## Class Activity: Applying the EWMA\n\nWe will use the following data to practice applying the Exponentially Weighted Moving Average (EWMA) technique.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nx <- c( 4.4, 4.2, 4.2, 4, 4.4, 4.7, 4.9, 5.3, 5.4, 5.5 )\n```\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:center;\"> t </th>\n   <th style=\"text-align:center;\"> x_t </th>\n   <th style=\"text-align:center;\"> a_t </th>\n   <th style=\"text-align:center;\"> Space for computations </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> 4.4 </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 2 </td>\n   <td style=\"text-align:center;\"> 4.2 </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 3 </td>\n   <td style=\"text-align:center;\"> 4.2 </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 4 </td>\n   <td style=\"text-align:center;\"> 4.0 </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> 4.4 </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 6 </td>\n   <td style=\"text-align:center;\"> 4.7 </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 7 </td>\n   <td style=\"text-align:center;\"> 4.9 </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 8 </td>\n   <td style=\"text-align:center;\"> 5.3 </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 9 </td>\n   <td style=\"text-align:center;\"> 5.4 </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 10 </td>\n   <td style=\"text-align:center;\"> 5.5 </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n## Class Activity: Highway Speeds in New York City (45 mins)\n\n:::: {.columns}\n\n::: {.column width=\"45%\"}\nThe Bruckner Expressway (I-278) cuts through the Bronx in New York City. Traffic sensors record the speed of cars every 5 minutes between Stratford Avenue and Castle Hill Avenue.\n\nThe data from 7/2/2022 to 7/17/2022 are contained in the file <a href=\"../data/ny_speeds.csv\" download>ny_speeds.csv</a>.\n(Source: City of New York Department of Transportation. Online Links: \n[http://a841‚Äêdotweb01.nyc.gov/datafeeds](https://data.beta.nyc/dataset/nyc-real-time-traffic-speed-data-feed-archived).)\nThese data have been cleaned to align the observations with five minute intervals.\n\nWe will read these data into a tsibble.\n:::\n\n::: {.column width=\"10%\"}\n<!-- empty column to create gap -->\n:::\n\n::: {.column width=\"45%\"}\n![Google Map showing the location of the data collection.](../images/ny_speed_google_map_small.png)\n:::\n\n::::\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n# Read the ny_speeds data\nny_speeds_dat <- rio::import(\"../data/ny_speeds.csv\")\n\nny_speeds_tb <- ny_speeds_dat |>\n  mutate(\n    year = lubridate::year(date),\n    month = lubridate::month(date),\n    #\n    day = lubridate::day(date),\n    hour = lubridate::hour(date),\n    min = lubridate::minute(date)\n  ) |>\n  rename(speed = Speed) |>\n  dplyr::select(-Id, -TravelTime, -Status, -DataAsOf, -linkId) |>\n  tibble()\n\nny_speeds_ts <- ny_speeds_tb |>\n  mutate(index = date) |>\n  as_tsibble(index = index)\n```\n:::\n\n\nNext, we compute the decomposition. We expect that that traffic will fluctuate in with daily seasonality. The number of five-minute periods in a day is:\n\n$$\n\\underbrace{\\frac{60}{5}}_{\\substack{\\text{Number of} \\\\ \\text{5-minute periods} \\\\ \\text{per hour}}} \\cdot \\underbrace{24}_{\\substack{\\text{Number of} \\\\ \\text{hours} \\\\ \\text{per day}}} = ~~ 288~~\\text{five-minute periods per day}\n$$\n\nThat is, the time series will follow a cycle that repeats every 288 five-minute intervals.\nDue to the complexity of the time series, we will indicate this to R in our function call.\nobservations. (Try omitting  \"~season(288)\" from the classical_decomposition statement and see what happens!)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nny_speeds_decompose <- ny_speeds_ts |>\n    model(feasts::classical_decomposition(speed ~ season(288),\n        type = \"add\"))  |>\n    components()\n\nautoplot(ny_speeds_decompose)\n```\n\n::: {.cell-output-display}\n![](chapter_3_lesson_2_class_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n::: {.callout-tip icon=false title=\"Check Your Understanding\"}\n\n-   Working with your partner, identify evidence in the original time series of the daily seasonal trend.\n-   What do you no notice about this time series?\n-   How do you explain the sharp downward spikes in the data?\n-   Does there seem to be a trend in the data? Justify your answer.\n-   Why is there no estimate for the trend or the random component for the first half of the first day and the last half of the last day?\n\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspeed_plot <- ny_speeds_decompose |> \n  filter((index) <= mdy_hm(\"7/3/2022 12:00\")) |> \n  na.omit() |> \n  dplyr::select(speed) |> \n  autoplot(.vars = speed)\nrand_plot <- ny_speeds_decompose |> \n  filter((index) <= mdy_hm(\"7/3/2022 12:00\")) |> \n  na.omit() |> \n  dplyr::select(random) |> \n  autoplot(.vars = random)\n\nspeed_plot / rand_plot\n```\n\n::: {.cell-output-display}\n![](chapter_3_lesson_2_class_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nHere are 48 hours of data, near the beginning of the time series.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nny_speeds_decompose |> \n  filter((index) <= mdy_hm(\"7/4/2022 12:00\")) |> \n  na.omit() |> \n  autoplot()\n```\n\n::: {.cell-output-display}\n![](chapter_3_lesson_2_class_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n\n## Recap (5 min)\n\nWorking with your partner, prepare to explain the following concepts to the class:\n\n-   xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n-   yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy\n\n\n\n<a href=\"javascript:showhide('Solutions1')\"\nstyle=\"font-size:.8em;\">Matching Activity</a>\n\n::: {#Solutions1 style=\"display:none;\"}\n\nSolutions to matching activity:\n\n1. D\n2. E\n3. B\n4. C\n5. A\n\n:::\n\n\n<a href=\"javascript:showhide('Solutions')\"\nstyle=\"font-size:.8em;\">Class Activity</a>\n\n::: {#Solutions style=\"display:none;\"}\n\nSolutions to Class Activity\n\nMatching Activity:\n\n1 - D\n\n2 - E\n\n3 - B\n\n4 - C\n\n5 - A\n\n\n\n::: {.cell}\n\n:::\n\n\n:::\n\n\n<a href=\"javascript:showhide('Solutions')\"\nstyle=\"font-size:.8em;\">Class Activity</a>\n\n::: {#Solutions style=\"display:none;\"}\n\nSolutions to Class Activity\n\nMatching Activity:\n\n1 - D\n\n2 - E\n\n3 - B\n\n4 - C\n\n5 - A\n\n\n\n::: {.cell}\n\n:::\n\n\n:::",
    "supporting": [
      "chapter_3_lesson_2_class_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\r\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}