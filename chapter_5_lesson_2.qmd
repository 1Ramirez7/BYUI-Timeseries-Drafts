---
title: "Harmonic Seasonal Variables"
subtitle: "Chapter 5: Lesson 2"
format: html
editor: source
sidebar: false
---

```{r}
#| include: false
source("common_functions.R")
```

```{=html}
<script type="text/javascript">
 function showhide(id) {
    var e = document.getElementById(id);
    e.style.display = (e.style.display == 'block') ? 'none' : 'block';
 }
 
 function openTab(evt, tabName) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " active";
 }    
</script>
```


## Learning Outcomes

{{< include outcomes/chapter_5_lesson_2_outcomes.qmd >}}




## Preparation

-   Read Section 5.6



## Learning Journal Exchange (10 min)

-   Review another student's journal

-   What would you add to your learning journal after reading another student's?

-   What would you recommend the other student add to their learning journal?

-   Sign the Learning Journal review sheet for your peer



## Class Activity: XXXXXXXXXXXXXXXXXXXXXX (xxx min)

::: {.callout-note title="Fourier Series"}
The **Fourier Series** is an infinite series representation of a smooth function $f(t)$ with period $s$:
$$
  f(t) = \frac{A_0}{2} + \sum_{i=1}^{\infty} \left\{ A_i \sin \left( \frac{2\pi i t}{s} \right) + B_i \cos \left( \frac{2\pi i t}{s} \right) \right\}
$$
The coefficients $A_i$ and $B_i$ are defined by the integrals:
$$
  A_i = \frac{2}{s} \int_0^s f(t) \cos \left( \frac{2\pi i t}{s} \right) \; dt
  ~~~~~~~~~~~~~~~~~~
  B_i = \frac{2}{s} \int_0^s f(t) \sin \left( \frac{2\pi i t}{s} \right) \; dt
$$

:::

The function $f(t)$ can be approximated to any desired level of precision by truncating the series after a sufficient number of terms.

The Fourier Series exists for any smooth (continuously differentiable) function. Note that this allows us to obtain the value of the function at any real value. 
For a time series with $s$ seasons, we are only need to evaluate the function at a finite number of points: 
$t = 1, 2, 3, \ldots, s-1, s$. Hence, we only need to obtain $\left\lfloor \frac{s}{2} \right\rfloor$ terms of this sum to fit the values perfectly. We can usually get a good approximation with only a few terms.

For a time series with $s$ seasons per cycle, our additive model can be written as:

\begin{align*}
  x_t
    &= m_t + s_t + z_t \\
    &= m_t +
        \sum_{i=1}^{\left\lfloor \frac{s}{2} \right\rfloor} \left\{ A_i \sin \left( \frac{2\pi i t}{s} \right) + B_i \cos \left( \frac{2\pi i t}{s} \right) \right\}
      + z_t
\end{align*}

# Continue from pg. 102


In trigonometry, you learned that
\begin{align*}
  \sin(\theta + \phi) 
    &= \sin(\theta)\cos(\phi)  + \cos(\theta)\sin(\phi)  \\
    &= \cos(\phi) \sin(\theta) + \sin(\phi) \cos(\theta) 
\end{align*}

Consider the sine wave with the following parameters:

-   $f$:$~~~$    the frequency or the number of cycles per sampling interval,
-   $A$:$~~$    the amplitude, and 
-   $\phi$:$~~~$ the phase shift.

\begin{align*}
  A \sin ( 2 \pi f t + \phi )
    &= \underbrace{A \cos( \phi )}_{\alpha_s} \cdot \sin ( 2 \pi f t ) + \underbrace{A \sin( \phi )}_{\alpha_c} \cdot \cos ( 2 \pi f t ) \\
    &= \alpha_s \cdot \sin ( 2 \pi f t ) + \alpha_c \cdot \cos ( 2 \pi f t ) 
\end{align*}

Using this sum/difference identity from trigonometry, we have transformed this from something that is not linear in the parameters $A$ and $\phi$ to an expression that is linear in the parameters $\alpha_s$ and $\alpha_c$.

<!-- Beginning of two columns -->
::: columns
::: {.column width="45%"}

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| label: fig-namegoeshereAlso
#| fig-cap: "Title goes here"

create_sine_df <- function(i = 1, max_t = 12) {
  periods <-  floor(max_t / 2)
  df <- tibble(
    t = seq(from = 0, to = max_t, length.out = 501),
    value = sin(2 * pi * i * t / periods),
    i = right(paste0(" ", as.character(i)), 2)
  )
  
}

sine_df <- create_sine_df(i = 1)
for (i in 2:6) {
  sine_df <- sine_df |> bind_rows(create_sine_df(i))
}

ggplot(sine_df, aes(x = t, y = 28 + value - 4*as.numeric(i), color = i)) +
  geom_line() +
  # geom_point(data = data.frame(x = 1:6, y = seq(4,24,4)), aes(x=x, y=y)) +
  scale_y_continuous(
    breaks = seq(4,24,4),
    minor_breaks = NULL,
    labels = NULL
  ) +
  scale_x_continuous(
    breaks = c(0:12),
    minor_breaks = NULL
  ) +
  scale_color_discrete(name = "i") +
  labs(x = "t", y = "Sine Value", title = "Sine Functions with Different Periods") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5)
  )
```

:::

::: {.column width="10%"}
<!-- empty column to create gap -->
:::

::: {.column width="45%"}

```{r}
#| code-fold: true
#| code-summary: "Show the code"
#| label: fig-namegoeshere
#| fig-cap: "Title goes here"

create_cosine_df <- function(i = 1, max_t = 12) {
  periods <-  floor(max_t / 2)
  df <- tibble(
    t = seq(from = 0, to = max_t, length.out = 501),
    value = cos(2 * pi * i * t / periods),
    i = right(paste0(" ", as.character(i)), 2)
  )
  
}

cosine_df <- create_cosine_df(i = 1)
for (i in 2:6) {
  cosine_df <- cosine_df |> bind_rows(create_cosine_df(i))
}

ggplot(cosine_df, aes(x = t, y = 28 + value - 4*as.numeric(i), color = i)) +
  geom_line() +
  # geom_point(data = data.frame(x = 1:6, y = seq(4,24,4)), aes(x=x, y=y)) +
  scale_y_continuous(
    breaks = seq(4,24,4),
    minor_breaks = NULL,
    labels = NULL
  ) +
  scale_x_continuous(
    breaks = c(0:12),
    minor_breaks = NULL
  ) +
  scale_color_discrete(name = "i") +
  labs(x = "t", y = "Cosine Value", title = "Cosine Functions with Different Periods") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5)
  )
```

:::
:::
<!-- End of two columns -->



```{r}
temps_ts <- rio::import("data/global_temparature.csv") |>
  as_tsibble(index = year) |>
  filter(year >= 1970)

temps_ts |> autoplot(.vars = change) +
    labs(
      x = "Year",
      y = "Temperature Change (Celsius)",
      title = paste0("Change in Mean Annual Global Temperature (", min(temps_ts$year), "-", max(temps_ts$year), ")")
    ) +
    theme_minimal() +
    theme(
      plot.title = element_text(hjust = 0.5)
    ) + 
  geom_smooth(method='lm', formula= y~x)
```



## Simulation

The following simulation illustrates harmonic seasonal terms.

```{=html}
 <iframe id="harmonicSeasons" src="https://posit.byui.edu/content/3fcf5813-76fe-44ee-ab7f-b4a99884c855" style="border: none; width: 100%; height: 1200px" frameborder="0"></iframe>
```

## Class Activity: SectionTitle (xxx min)

In the previous lesson, we learned how to incorporate an indicator (or dummy) variable for each season in a period. If there are twelve months in a year, this requires having twelve parameters in the model. Given that many seasonal changes are gradual and can be modeled by a continuous function, we can use sines and cosines to approximate the seasonal variation. This can lead to a smaller number of parameters than is required for the indicator variable approach. 

## Small-Group Activity: SectionTitle (xxx min)

<!-- Check your Understanding -->

::: {.callout-tip icon=false title="Check Your Understanding"}

-   Question1
-   Question2

:::





## Homework Preview (5 min)

-   Review upcoming homework assignment
-   Clarify questions




::: {.callout-note icon=false}

## Download Homework

<a href="https://byuistats.github.io/timeseries/homework/homework_5_2.qmd" download="homework_5_2.qmd"> homework_5_2.qmd </a>

:::





<a href="javascript:showhide('Solutions1')"
style="font-size:.8em;">Class Activity</a>
  
::: {#Solutions1 style="display:none;"}
    

:::




<a href="javascript:showhide('Solutions')"
style="font-size:.8em;">Class Activity</a>
  
::: {#Solutions2 style="display:none;"}
    

:::




<a href="javascript:showhide('Solutions3')"
style="font-size:.8em;">Class Activity</a>
  
::: {#Solutions3 style="display:none;"}
    

:::



