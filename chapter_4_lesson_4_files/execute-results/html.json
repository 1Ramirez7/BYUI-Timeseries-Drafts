{
  "hash": "9026315e62b09dfd8df1b0f1a45b09df",
  "result": {
    "markdown": "---\ntitle: \"Autoregressive Models: Part 2 (MAYBE RECOMBINE)\"\nsubtitle: \"Chapter 4: Lesson 4\"\nformat: html\neditor: source\nsidebar: false\n---\n\n\n\n```{=html}\n<script type=\"text/javascript\">\n function showhide(id) {\n    var e = document.getElementById(id);\n    e.style.display = (e.style.display == 'block') ? 'none' : 'block';\n }\n \n function openTab(evt, tabName) {\n    var i, tabcontent, tablinks;\n    tabcontent = document.getElementsByClassName(\"tabcontent\");\n    for (i = 0; i < tabcontent.length; i++) {\n        tabcontent[i].style.display = \"none\";\n    }\n    tablinks = document.getElementsByClassName(\"tablinks\");\n    for (i = 0; i < tablinks.length; i++) {\n        tablinks[i].className = tablinks[i].className.replace(\" active\", \"\");\n    }\n    document.getElementById(tabName).style.display = \"block\";\n    evt.currentTarget.className += \" active\";\n }    \n</script>\n```\n\n\n\n## Learning Outcomes\n\n<h1> OUTCOMES DOCUMENT NEEDS TO BE REVISED: DO THESE REALLY GO HERE? </h1>\n\n<details>\n\n<summary>Fit time series models to data and interpret fitted parameters</summary>\n-   Explain how to estimate a random walk with increasing slope using Holt-Winters\n-   Fit an $AR(p)$ model to simulated data\n-   Explain the difference between parameters of the data generating process and estimates\n-   Calculate confidence intervals for AR coefficient estimates\n-   Interpret AR coefficient estimates in the context of the source and nature of historical data\n\n</details>\n\n\n\n<details>\n\n<summary>Check model adequacy using diagnostic plots like correlograms of residuals</summary>\n-   Characterize a random walk's second order characteristics using a correlogram\n-   Define partial autocorrelations\n-   Explain how to use a partial correlogram to decide what model would be suitable to estimate an $AR(p)$ process\n-   Demonstrate the use of partial correlogram using a simulation and plots\n-   Compare AR fitted models to an underlying data generating process\n-   Explain the limitations of stochastic model fitting as evidence in favor or against real world arguments.\n\n</details>\n\n\n\n\n\n\n## Preparation\n\n-   Read Sections 4.5.3-4.5.7\n\n\n\n## Learning Journal Exchange (10 mins)\n\n-   Review another student's journal\n\n-   What would you add to your learning journal after reading another student's?\n\n-   What would you recommend the other student add to their learning journal?\n\n-   Sign the Learning Journal review sheet for your peer\n\n\n## Class Activity: Exploring $AR(1)$ Models (20 min)\n\n### Recall the Definition\n\nRecall that an $AR(p)$ model is of the form\n$$\n  x_t = \\alpha_1 x_{t-1} + \\alpha_2 x_{t-2} + \\alpha_3 x_{t-3} + \\cdots + \\alpha_{p-1} x_{t-(p-1)} + \\alpha_p x_{t-p} + w_t\n$$\nSo, an $AR(1)$ model is expressed as\n$$\n  x_t = \\alpha x_{t-1} + w_t\n$$\nwhere $\\{w_t\\}$ is a white noise series with mean zero and variance $\\sigma^2$. \n\n### Second-Order Properties of an $AR(1)$ Model\n\nWe now explore the second-order properties of this model. \n\n::: {.callout-note icon=false title=\"Second-Order Properties of an $AR(1)$ Model\"}\n\nIf $\\{x_t\\}_{t=1}^n$ is an $AR(1)$ prcess, then its the first- and second-order properties are summarized below.\n\n$$\n\\begin{align*}\n  \\mu_x &= 0 \\\\  \n  \\gamma_k = cov(x_t, x_{t+k}) &= \\frac{\\alpha^k \\sigma^2}{1-\\alpha^2}\n\\end{align*}\n$$\n\n::: {.callout-tip title=\"Click here for a proof of the equation for $cov(x_t,x_{t+k})$\" collapse=true}\n\nWhy is $cov(x_t, x_{t+k}) = \\dfrac{\\alpha^k \\sigma^2}{1-\\alpha^2}$?\n\nIf $\\{x_t\\}$ is a stable $AR(1)$ process (which means that $|\\alpha|<1) can be written as:\n\n\\begin{align*}\n  (1-\\alpha \\mathbf{B}) x_t &= w_t \\\\\n  \\implies x_t &= (1-\\alpha \\mathbf{B})^{-1} w_t \\\\\n    &= w_t + \\alpha w_{t-1} + \\alpha^2 w_{t-2} + \\alpha^3 w_{t-3} + \\cdots \\\\\n    &= \\sum\\limits_{i=0}^\\infty \\alpha^i w_{t-i}\n\\end{align*}\n\nFrom this, we can deduce that the mean is \n\n$$\n  E(x_t) \n    = E\\left( \\sum\\limits_{i=0}^\\infty \\alpha^i w_{t-i} \\right)\n    = \\sum\\limits_{i=0}^\\infty \\alpha^i E\\left( w_{t-i} \\right)\n    = 0\n$$\n\nThe autocovariance is computed similarly as:\n\n\\begin{align*}\n  \\gamma_k = cov(x_t, x_{t+k}) \n    &= cov \\left( \n      \\sum\\limits_{i=0}^\\infty \\alpha^i w_{t-i}, \\\\\n      \\sum\\limits_{j=0}^\\infty \\alpha^j w_{t+k-j} \\right) \\\\\n    &= \\sum\\limits_{j=k+i} \\alpha^i \\alpha^j cov ( w_{t-i}, w_{t+k-j} ) \\\\\n    &= \\alpha^k \\sigma^2 \\sum\\limits_{i=0}^\\infty \\alpha^{2i} \\\\\n    &= \\frac{\\alpha^k \\sigma^2}{1-\\alpha^2}\n\\end{align*}\n\nSee Equations (2.15) and (4.2).\n\n:::\n\n:::\n\n\n\n### Correlogram of an $AR(1)$ process\n\n::: {.callout-note icon=false title=\"Correlogram of an AR(1) Process\"}\n\nThe autocorrelation function for an AR(1) process is\n\n$$\n  \\rho_k = \\alpha^k ~~~~~~ (k \\ge 0)\n$$\nwhere $|\\alpha| \\le 1$. \n\n:::\n\n\n<!-- Check Your Understanding -->\n\n::: {.callout-tip icon=false title=\"Check Your Understanding\"}\n\n-   Use the equation for the autocovariance function, $\\gamma_k$, to show that \n$$\n  \\rho_k = \\alpha^k\n$$\nfor $k \\ge 0$ when $|\\alpha|<1$.\n\n-   Use this to explain why the correlogram decays to zero more quickly when $\\alpha$ is small.\n\n:::\n\n### Small Group Activity: Simulation of an $AR(1)$ Process\n\n\n```{=html}\n <iframe id=\"AR1_app\" src=\"https://posit.byui.edu/content/be8ec2cd-6209-4b53-a5c6-be11464b86de\" style=\"border: none; width: 100%; height: 1100px\" frameborder=\"0\"></iframe>\n```\n\n\n\n<!-- Check Your Understanding -->\n\n::: {.callout-tip icon=false title=\"Check Your Understanding\"}\n\nIn each of the following cases, what do you observe in the correlogram? (If you expect to see significant results and you do not, try increasing the number of points.)\n\n-   $\\alpha = 1$\n-   $\\alpha = 0.5$\n-   $\\alpha = 0.1$\n-   $\\alpha = 0$   \n-   $\\alpha = -0.1$\n-   $\\alpha = -0.5$\n-   $\\alpha = -1$\n\n:::\n\n\n## Class Activity: Partial Autocorrelation (10 min)\n\n### Definition of Partial Autocorrelation\n\n::: {.callout-note icon=false title=\"Partial Autocorrleation\"}\n\nThe **partial autocorrelation** at lag $k$ is defined as the portion of the correlation that is not explained by shorter lags.\n\n:::\n\nFor example, the partial correlation for lag 4 is the correlation not explained by lags 1, 2, or 3.\n\n\n<!-- Check Your Understanding -->\n\n::: {.callout-tip icon=false title=\"Check Your Understanding\"}\n\n-   What is the value of the partial autocorrelation function for an $AR(2)$ process for all lags greater than 2?\n<!-- Zero -->\n\n:::\n\nOn page 81, the textbook states that in general, the partial autocorrelation at lag $k$ is the $k^{th}$ coefficient of a fitted $AR(k)$ model.\nThis implies that if the underlying process is $AR(p)$, then all the coefficients $\\alpha_k=0$ if $k>p$. So, an $AR(p)$ process will yeild partial correlations that are zero after lag $p$. So, a correlogram of partial autocorrelations can be helpful to determine the order of an appropriate $AR$ process to model a time series.\n\n### Example: McDonald's Stock Price\n\nHere is a partial autocorrelation plot for the McDonald's stock price data:\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Show the code\"}\n# Set symbol and date range\nsymbol <- \"MCD\"\ncompany <- \"McDonald's\"\n\n# Retrieve static file\nstock_df <- rio::import(\"data/stock_price_mcd.parquet\")\n\n# Transform data into tibble\nstock_ts <- stock_df %>%\n  mutate(\n    dates = date, \n    value = adjusted\n  ) %>%\n  select(dates, value) %>%\n  as_tibble() %>% \n  arrange(dates) |>\n  mutate(diff = value - lag(value)) |>\n  as_tsibble(index = dates, key = NULL) \n\npacf(stock_ts$value, plot=TRUE, lag.max = 25)\n```\n\n::: {.cell-output-display}\n![](chapter_4_lesson_4_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\nThe only significant partial correlation is at lag $k=1$. This suggests that an $AR(1)$ process could be used to model the McDonald's stock prices.\n\n### Partial Autocorrelation Plots of Various $AR(p)$ Processes\n\nHere are some time plots, correlograms, and partial correlograms for $AR(p)$ processes with various values of $p$.\n\n### Shiny App\n\n\n```{=html}\n <iframe id=\"FittedModels_app\" src=\"https://posit.byui.edu/content/6c451298-48a0-43a4-b8e2-52d9adc6baeb\" style=\"border: none; width: 100%; height: 1400px\" frameborder=\"0\"></iframe>\n```\n\n\n### google sheets test\n\n\n```{=html}\n <iframe id=\"googlesheets\" src=\"https://docs.google.com/spreadsheets/d/1K0yK3Ck08FBgPp8eDxw4aa7NhwDvuhTvb04U0ZjqB4A/edit?usp=sharing\" style=\"border: none; width: 100%; height: 1100px\" frameborder=\"0\"></iframe>\n```\n\n\n\n::: panel-tabset\n\n#### $AR(1)$\n\n::: {.callout-tip appearance=\"minimal\"}\n\n\n::: {.cell}\n\n:::\n\n\n$$\n  x_t = 0.7 x_{t-1} + w_t\n$$\n\n\n::: {.cell fig.asp='0.5'}\n::: {.cell-output-display}\n![](chapter_4_lesson_4_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](chapter_4_lesson_4_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](chapter_4_lesson_4_files/figure-html/unnamed-chunk-4-3.png){width=672}\n:::\n:::\n\n\n:::\n\n#### $AR(2)$\n\n::: {.callout-tip appearance=\"minimal\"}\n\n\n::: {.cell}\n\n:::\n\n\n$$\n  x_t = 0.5 x_{t-1} + 0.5 x_{t-2} + w_t\n$$\n\n\n::: {.cell fig.asp='0.5'}\n::: {.cell-output-display}\n![](chapter_4_lesson_4_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](chapter_4_lesson_4_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](chapter_4_lesson_4_files/figure-html/unnamed-chunk-6-3.png){width=672}\n:::\n:::\n\n\n:::\n\n#### $AR(3)$\n\n::: {.callout-tip appearance=\"minimal\"}\n\n\n::: {.cell}\n\n:::\n\n\n$$\n  x_t = 0.25 x_{t-1} + 0.2 x_{t-2} + 0.15 x_{t-3} + w_t\n$$\n\n\n::: {.cell fig.asp='0.5'}\n::: {.cell-output-display}\n![](chapter_4_lesson_4_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](chapter_4_lesson_4_files/figure-html/unnamed-chunk-8-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](chapter_4_lesson_4_files/figure-html/unnamed-chunk-8-3.png){width=672}\n:::\n:::\n\n\n:::\n\n:::\n<!-- End of the panel-tabset -->\n\n\n\n<!-- Check Your Understanding -->\n\n::: {.callout-tip icon=false title=\"Check Your Understanding\"}\n\n-   Question1\n-   Question2\n\n:::\n\n# Finish previous section\n\n\n\n<!-- Check Your Understanding -->\n\n::: {.callout-tip icon=false title=\"Check Your Understanding\"}\n\n-   Stuff goes here\n-   Stuff goes here\n\n:::\n\n\n\n\n\n\n\n\n\n\n\n<!-- Check your Understanding -->\n\n::: {.callout-tip icon=false title=\"Check Your Understanding\"}\n\n-   Question1\n-   Question2\n\n:::\n\n\n\n\n\n## Homework Preview (5 min)\n\n-   Review upcoming homework assignment\n-   Clarify questions\n\n\n::: {.callout-note icon=false}\n\n## Download Homework\n\n<a href=\"https://byuistats.github.io/timeseries/homework/homework_4_4.qmd\" download=\"homework_4_4.qmd\"> homework_4_4.qmd </a>\n\n:::\n\n\n<a href=\"javascript:showhide('Solutions1')\"\nstyle=\"font-size:.8em;\">Class Activity</a>\n  \n::: {#Solutions1 style=\"display:none;\"}\n    \n\n:::\n\n\n\n\n<a href=\"javascript:showhide('Solutions')\"\nstyle=\"font-size:.8em;\">Class Activity</a>\n  \n::: {#Solutions2 style=\"display:none;\"}\n    \n\n:::\n\n\n\n\n<a href=\"javascript:showhide('Solutions3')\"\nstyle=\"font-size:.8em;\">Class Activity</a>\n  \n::: {#Solutions3 style=\"display:none;\"}\n    \n\n:::\n\n\n\n",
    "supporting": [
      "chapter_4_lesson_4_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}